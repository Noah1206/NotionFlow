{% extends "base_dashboard.html" %}

{% block title %}ì¹œêµ¬ - NodeFlow ëŒ€ì‹œë³´ë“œ{% endblock %}

{% block description %}NodeFlowì—ì„œ ì¹œêµ¬ë¥¼ ê´€ë¦¬í•˜ê³  ìº˜ë¦°ë”ë¥¼ ê³µìœ í•˜ì„¸ìš”.{% endblock %}

{% block content %}
<div class="dashboard-content animate-fade-in">
    <!-- ğŸ“Š í˜ì´ì§€ í—¤ë” -->
    <div class="dashboard-header">
        <div class="header-content">
            <h1 class="page-title">
                <span class="title-icon">ğŸ‘¥</span>
                ì¹œêµ¬
            </h1>
            <p class="page-description">ì¹œêµ¬ë¥¼ ì¶”ê°€í•˜ê³  ìº˜ë¦°ë”ë¥¼ ê³µìœ í•˜ì„¸ìš”</p>
        </div>
    </div>

    <!-- ğŸ“± ì¹œêµ¬ ê´€ë¦¬ ë©”ì¸ ì»¨í…ì¸  -->
    <div class="friends-container">
        <!-- ì¹œêµ¬ íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="friends-tabs">
            <button class="friends-tab-btn active" onclick="showFriendsSection('list')">
                ì¹œêµ¬ ëª©ë¡
            </button>
            <button class="friends-tab-btn" onclick="showFriendsSection('add')">
                ì¹œêµ¬ ì¶”ê°€
            </button>
            <button class="friends-tab-btn" onclick="showFriendsSection('requests')">
                ì¹œêµ¬ ìš”ì²­
            </button>
        </div>

        <!-- ì¹œêµ¬ ëª©ë¡ ì„¹ì…˜ -->
        <div class="friends-section active" id="friends-list-section">
            <div class="section-header">
                <h2>ì¹œêµ¬ ëª©ë¡</h2>
                <div class="friends-stats">
                    <span class="friends-count">0ëª…</span>
                </div>
            </div>
            
            <div class="friends-grid" id="friends-list-grid">
                <!-- ì¹œêµ¬ ëª©ë¡ì´ ì—¬ê¸°ì— ë¡œë“œë©ë‹ˆë‹¤ -->
                <div class="no-friends-message">
                    <div class="no-friends-icon">ğŸ‘‹</div>
                    <h3>ì•„ì§ ì¹œêµ¬ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                    <p>ì¹œêµ¬ë¥¼ ì¶”ê°€í•˜ì—¬ ìº˜ë¦°ë”ë¥¼ ê³µìœ í•´ë³´ì„¸ìš”!</p>
                    <button class="btn-primary" onclick="showFriendsSection('add')">
                        ì¹œêµ¬ ì¶”ê°€í•˜ê¸°
                    </button>
                </div>
            </div>
        </div>

        <!-- ì¹œêµ¬ ì¶”ê°€ ì„¹ì…˜ -->
        <div class="friends-section" id="friends-add-section">
            <div class="section-header">
                <h2>ì¹œêµ¬ ì¶”ê°€</h2>
            </div>
            
            <div class="friend-search-container">
                <div class="search-form">
                    <input type="text" 
                           id="friend-search-input" 
                           placeholder="ì‚¬ìš©ìëª… ë˜ëŠ” ì´ë©”ì¼ë¡œ ê²€ìƒ‰í•˜ì„¸ìš”"
                           class="search-input">
                    <button class="btn-search" onclick="searchFriends()">
                        ê²€ìƒ‰
                    </button>
                </div>
                
                <div class="search-results" id="friend-search-results">
                    <!-- ê²€ìƒ‰ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>

        <!-- ì¹œêµ¬ ìš”ì²­ ì„¹ì…˜ -->
        <div class="friends-section" id="friends-requests-section">
            <div class="section-header">
                <h2>ì¹œêµ¬ ìš”ì²­</h2>
                <div class="requests-badge">
                    <span class="requests-count">0</span>
                </div>
            </div>
            
            <div class="friend-requests-container" id="friend-requests-container">
                <!-- ì¹œêµ¬ ìš”ì²­ì´ ì—¬ê¸°ì— ë¡œë“œë©ë‹ˆë‹¤ -->
                <div class="no-requests-message">
                    <div class="no-requests-icon">ğŸ“¬</div>
                    <h3>ìƒˆë¡œìš´ ì¹œêµ¬ ìš”ì²­ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                    <p>ì¹œêµ¬ ìš”ì²­ì´ ìˆìœ¼ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block page_styles %}
/* ğŸ¨ ì¹œêµ¬ í˜ì´ì§€ ì „ìš© ìŠ¤íƒ€ì¼ */
.friends-container {
    max-width: 1000px;
    margin: 0 auto;
}

.friends-tabs {
    display: flex;
    border-bottom: 2px solid var(--border-primary);
    margin-bottom: 24px;
    gap: 0;
}

.friends-tab-btn {
    flex: 1;
    padding: 12px 20px;
    background: none;
    border: none;
    font-size: 16px;
    font-weight: 500;
    color: var(--text-secondary);
    cursor: pointer;
    border-bottom: 3px solid transparent;
    transition: all 0.15s ease;
}

.friends-tab-btn:hover {
    color: var(--text-primary);
    background: #141414 !important;
}

.friends-tab-btn.active {
    color: var(--text-primary);
    border-bottom-color: var(--text-primary);
    background: #141414 !important;
}

.friends-section {
    display: none;
}

.friends-section.active {
    display: block;
    animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
}

.section-header h2 {
    font-size: 24px;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0;
}

.friends-stats,
.requests-badge {
    background: #141414 !important;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: 500;
    color: var(--text-secondary);
}

.friends-count,
.requests-count {
    color: var(--text-primary);
    font-weight: 600;
}

/* ì¹œêµ¬ ëª©ë¡ ê·¸ë¦¬ë“œ */
.friends-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 16px;
}

.friend-card {
    background: var(--bg-card);
    border: 1px solid var(--border-primary);
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    transition: all 0.15s ease;
}

.friend-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-xl);
}

.friend-avatar {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: #141414 !important;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    margin: 0 auto 12px;
}

.friend-name {
    font-size: 18px;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 4px;
}

.friend-status {
    font-size: 14px;
    color: var(--text-secondary);
    margin-bottom: 16px;
}

.friend-actions {
    display: flex;
    gap: 8px;
    justify-content: center;
}

.friend-actions button {
    padding: 6px 12px;
    border-radius: 6px;
    border: none;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.15s ease;
}

.btn-share {
    background: var(--text-primary);
    color: var(--bg-primary);
}

.btn-share:hover {
    background: var(--text-secondary);
}

.btn-remove {
    background: var(--text-primary);
    color: var(--bg-primary);
}

.btn-remove:hover {
    background: var(--text-secondary);
}

/* ë¹ˆ ìƒíƒœ ë©”ì‹œì§€ */
.no-friends-message,
.no-requests-message {
    text-align: center;
    padding: 60px 20px;
    color: var(--text-secondary);
}

.no-friends-icon,
.no-requests-icon {
    font-size: 48px;
    margin-bottom: 16px;
}

.no-friends-message h3,
.no-requests-message h3 {
    font-size: 20px;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 8px;
}

.no-friends-message p,
.no-requests-message p {
    font-size: 16px;
    margin-bottom: 20px;
}

/* ê²€ìƒ‰ í¼ */
.friend-search-container {
    max-width: 600px;
    margin: 0 auto;
}

.search-form {
    display: flex;
    gap: 12px;
    margin-bottom: 24px;
}

.search-input {
    flex: 1;
    padding: 12px 16px;
    border: 2px solid var(--border-primary);
    border-radius: 8px;
    font-size: 16px;
    background: #141414 !important;
    color: var(--text-primary);
    transition: all 0.15s ease;
}

.search-input:focus {
    outline: none;
    border-color: var(--text-primary);
    box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.1);
}

.btn-search {
    background: var(--text-primary);
    color: var(--bg-primary);
    border: none;
    padding: 12px 24px;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.15s ease;
}

.btn-search:hover {
    background: var(--text-secondary);
}

.search-results {
    min-height: 200px;
}

.search-result-item {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 16px;
    background: var(--bg-card);
    border: 1px solid var(--border-primary);
    border-radius: 8px;
    margin-bottom: 12px;
}

.search-result-avatar {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: #141414 !important;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
}

.search-result-info {
    flex: 1;
}

.search-result-name {
    font-size: 16px;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 4px;
}

.search-result-email {
    font-size: 14px;
    color: var(--text-secondary);
}

.btn-add-friend {
    background: var(--text-primary);
    color: var(--bg-primary);
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.15s ease;
}

.btn-add-friend:hover {
    background: var(--text-secondary);
}

/* ë°˜ì‘í˜• ë””ìì¸ */
@media (max-width: 768px) {
    .friends-tabs {
        flex-direction: column;
    }
    
    .friends-tab-btn {
        border-bottom: 1px solid var(--border-primary);
        border-right: none;
    }
    
    .friends-tab-btn.active {
        border-bottom-color: var(--text-primary);
    }
    
    .friends-grid {
        grid-template-columns: 1fr;
    }
    
    .search-form {
        flex-direction: column;
    }
}
{% endblock %}

{% block extra_js %}
<script>
// ì¹œêµ¬ í˜ì´ì§€ JavaScript
let currentFriendsSection = 'list';
let friendsData = {
    friends: [],
    requests: [],
    searchResults: []
};

// ì¹œêµ¬ ì„¹ì…˜ ì „í™˜
function showFriendsSection(section) {
    // íƒ­ ë²„íŠ¼ ì—…ë°ì´íŠ¸
    document.querySelectorAll('.friends-tab-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    document.querySelector(`[onclick="showFriendsSection('${section}')"]`).classList.add('active');
    
    // ì„¹ì…˜ í‘œì‹œ ì—…ë°ì´íŠ¸
    document.querySelectorAll('.friends-section').forEach(sec => {
        sec.classList.remove('active');
    });
    document.getElementById(`friends-${section}-section`).classList.add('active');
    
    currentFriendsSection = section;
    
    // ì„¹ì…˜ë³„ ë°ì´í„° ë¡œë“œ
    switch(section) {
        case 'list':
            loadFriendsList();
            break;
        case 'add':
            // ê²€ìƒ‰ ì…ë ¥ì°½ í¬ì»¤ìŠ¤
            setTimeout(() => {
                const searchInput = document.getElementById('friend-search-input');
                if (searchInput) searchInput.focus();
            }, 100);
            break;
        case 'requests':
            loadFriendRequests();
            break;
    }
}

// ì¹œêµ¬ ëª©ë¡ ë¡œë“œ
function loadFriendsList() {
    // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” API í˜¸ì¶œ
    const friendsGrid = document.getElementById('friends-list-grid');
    
    if (friendsData.friends.length === 0) {
        friendsGrid.innerHTML = `
            <div class="no-friends-message">
                <div class="no-friends-icon">ğŸ‘‹</div>
                <h3>ì•„ì§ ì¹œêµ¬ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                <p>ì¹œêµ¬ë¥¼ ì¶”ê°€í•˜ì—¬ ìº˜ë¦°ë”ë¥¼ ê³µìœ í•´ë³´ì„¸ìš”!</p>
                <button class="btn-primary" onclick="showFriendsSection('add')">
                    ì¹œêµ¬ ì¶”ê°€í•˜ê¸°
                </button>
            </div>
        `;
    } else {
        // ì¹œêµ¬ ì¹´ë“œ ë Œë”ë§
        friendsGrid.innerHTML = friendsData.friends.map(friend => `
            <div class="friend-card">
                <div class="friend-avatar">${friend.avatar || 'ğŸ‘¤'}</div>
                <div class="friend-name">${friend.name}</div>
                <div class="friend-status">${friend.isOnline ? 'ì˜¨ë¼ì¸' : 'ì˜¤í”„ë¼ì¸'}</div>
                <div class="friend-actions">
                    <button class="btn-share" onclick="shareCalendarWithFriend('${friend.id}')">
                        ìº˜ë¦°ë” ê³µìœ 
                    </button>
                    <button class="btn-remove" onclick="removeFriend('${friend.id}')">
                        ì‚­ì œ
                    </button>
                </div>
            </div>
        `).join('');
    }
    
    // ì¹œêµ¬ ìˆ˜ ì—…ë°ì´íŠ¸
    document.querySelector('.friends-count').textContent = `${friendsData.friends.length}ëª…`;
}

// ì¹œêµ¬ ê²€ìƒ‰
function searchFriends() {
    const searchInput = document.getElementById('friend-search-input');
    const query = searchInput.value.trim();
    
    if (!query) {
        alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
        return;
    }
    
    // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” API í˜¸ì¶œ
    console.log('ì¹œêµ¬ ê²€ìƒ‰:', query);
    
    // ì„ì‹œ ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ
    const resultsContainer = document.getElementById('friend-search-results');
    resultsContainer.innerHTML = `
        <div class="no-requests-message">
            <div class="no-requests-icon">ğŸ”</div>
            <h3>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
            <p>ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë¡œ ì‹œë„í•´ë³´ì„¸ìš”.</p>
        </div>
    `;
}

// ì¹œêµ¬ ìš”ì²­ ë¡œë“œ
function loadFriendRequests() {
    const requestsContainer = document.getElementById('friend-requests-container');
    
    if (friendsData.requests.length === 0) {
        requestsContainer.innerHTML = `
            <div class="no-requests-message">
                <div class="no-requests-icon">ğŸ“¬</div>
                <h3>ìƒˆë¡œìš´ ì¹œêµ¬ ìš”ì²­ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                <p>ì¹œêµ¬ ìš”ì²­ì´ ìˆìœ¼ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
            </div>
        `;
    }
    
    // ìš”ì²­ ìˆ˜ ì—…ë°ì´íŠ¸
    document.querySelector('.requests-count').textContent = friendsData.requests.length;
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
document.addEventListener('DOMContentLoaded', function() {
    showFriendsSection('list');
});
</script>
{% endblock %}