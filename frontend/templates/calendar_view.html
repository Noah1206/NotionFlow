<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>캘린더 - NotionFlow | 일정 관리</title>
    <meta name="description" content="NotionFlow 통합 캘린더에서 일정을 관리하고 할일을 추가하세요.">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='images/favicon.svg') }}">
    <link rel="icon" type="image/svg+xml" sizes="16x16" href="{{ url_for('static', filename='images/favicon-16x16.svg') }}">
    <link rel="icon" type="image/svg+xml" sizes="32x32" href="{{ url_for('static', filename='images/favicon-32x32.svg') }}">
    <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='images/apple-touch-icon.svg') }}">
    <link rel="icon" type="image/svg+xml" sizes="192x192" href="{{ url_for('static', filename='images/icon-192x192.svg') }}">
    <link rel="icon" type="image/svg+xml" sizes="512x512" href="{{ url_for('static', filename='images/icon-512x512.svg') }}">
    
    <!-- Web App Manifest -->
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    <meta name="theme-color" content="#3B82F6">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-tertiary: #f5f5f5;
            --text-primary: #000000;
            --text-secondary: #666666;
            --text-tertiary: #999999;
            --accent-primary: #3B82F6;
            --accent-secondary: #e3f2fd;
            --border-color: #e5e5e5;
            --border-light: #f0f0f0;
            --shadow-light: rgba(0, 0, 0, 0.1);
            --shadow-medium: rgba(0, 0, 0, 0.15);
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .calendar-app {
            display: flex;
            min-height: 100vh;
            padding-top: 80px;
        }

        /* 사이드바 스타일 */
        .sidebar {
            width: 280px;
            background: var(--bg-primary);
            border-right: 1px solid var(--border-color);
            padding: 2rem 1.5rem;
            overflow-y: auto;
            position: fixed;
            top: 80px;
            left: 0;
            bottom: 0;
            z-index: 10;
        }

        .sidebar-section {
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .sync-button {
            background: var(--accent-primary);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 0.75rem 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 1rem;
            width: 100%;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .sync-button:hover {
            background: #1d4ed8;
            transform: translateY(-1px);
        }

        .settings-button {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .settings-button:hover {
            background: var(--border-color);
        }

        /* Daily Routine */
        .routine-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            border-radius: 6px;
            transition: background 0.2s ease;
        }

        .routine-item:hover {
            background: var(--bg-tertiary);
        }

        .routine-time {
            background: var(--text-primary);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            min-width: 50px;
            text-align: center;
        }

        .routine-title {
            font-size: 0.9rem;
            color: var(--text-primary);
        }

        /* 캐릭터 */
        .character-section {
            text-align: center;
            margin: 1.5rem 0;
        }

        .characters {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .character {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--bg-tertiary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .character:hover {
            transform: scale(1.1);
            background: var(--accent-secondary);
        }

        /* 데이터베이스 목록 */
        .database-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .database-item:hover {
            background: var(--bg-tertiary);
        }

        .database-icon {
            width: 20px;
            height: 20px;
            color: var(--text-secondary);
        }

        .database-name {
            font-size: 0.9rem;
            color: var(--text-primary);
        }

        /* 메인 캘린더 영역 */
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 2rem;
        }

        .calendar-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 2rem;
            background: var(--bg-primary);
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px var(--shadow-light);
        }

        .calendar-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .calendar-nav {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .nav-button {
            background: none;
            border: none;
            padding: 0.5rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--text-secondary);
        }

        .nav-button:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .month-year {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            min-width: 140px;
            text-align: center;
        }

        .notion-badge {
            background: #ff6b35;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        /* 캘린더 그리드 */
        .calendar-grid {
            background: var(--bg-primary);
            border-radius: 12px;
            box-shadow: 0 2px 8px var(--shadow-light);
            overflow: hidden;
        }

        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border-color);
        }

        .weekday {
            padding: 1rem;
            text-align: center;
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
        }

        .calendar-day {
            min-height: 120px;
            border-right: 1px solid var(--border-light);
            border-bottom: 1px solid var(--border-light);
            padding: 0.75rem;
            position: relative;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .calendar-day:hover {
            background: var(--bg-secondary);
        }

        .calendar-day:nth-child(7n) {
            border-right: none;
        }

        .day-number {
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .day-number.today {
            background: #ff4757;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .day-number.other-month {
            color: var(--text-tertiary);
        }

        /* 이벤트 스타일 */
        .event {
            background: var(--bg-tertiary);
            border-radius: 6px;
            padding: 0.25rem 0.5rem;
            margin-bottom: 0.25rem;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border-left: 3px solid var(--accent-primary);
        }

        .event:hover {
            background: var(--accent-secondary);
            transform: translateX(2px);
        }

        .event.task {
            border-left-color: var(--warning-color);
        }

        .event.completed {
            border-left-color: var(--success-color);
            text-decoration: line-through;
            opacity: 0.7;
        }

        .event-title {
            font-weight: 500;
            margin-bottom: 0.1rem;
        }

        .event-subtitle {
            font-size: 0.7rem;
            color: var(--text-secondary);
        }

        .event-done {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.7rem;
            color: var(--success-color);
            font-weight: 600;
        }

        /* 반응형 */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 1rem;
            }

            .calendar-day {
                min-height: 80px;
                padding: 0.5rem;
            }

            .calendar-header {
                flex-direction: column;
                gap: 1rem;
            }
        }

        /* 추가 스타일 */
        .add-event-btn {
            position: absolute;
            bottom: 0.5rem;
            right: 0.5rem;
            width: 20px;
            height: 20px;
            background: var(--accent-primary);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            opacity: 0;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }

        .calendar-day:hover .add-event-btn {
            opacity: 1;
        }

        .task-dump {
            background: #ff4757;
            color: white;
            padding: 0.5rem;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .task-dump:hover {
            background: #ff3742;
        }
    </style>
</head>

<body>
    {% include 'components/header.html' %}

    <div class="calendar-app">
        <!-- 사이드바 -->
        <div class="sidebar">
            <!-- 동기화 및 설정 버튼 -->
            <div class="sidebar-section">
                <button class="sync-button" onclick="syncCalendar()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="1 4 1 10 7 10"/>
                        <path d="M3.51 15A9 9 0 0 0 21 12A9 9 0 0 0 11.5 3L3.51 15"/>
                    </svg>
                    지금 동기화
                </button>
                <button class="settings-button" onclick="openSettings()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M12 1V5M12 19V23M4.22 4.22L6.34 6.34M17.66 17.66L19.78 19.78M1 12H5M19 12H23M4.22 19.78L6.34 17.66M17.66 6.34L19.78 4.22"/>
                    </svg>
                    설정
                </button>
            </div>

            <!-- Daily Routine -->
            <div class="sidebar-section">
                <h3 class="section-title">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <polyline points="12,6 12,12 16,14"/>
                    </svg>
                    DAILY ROUTINE
                </h3>
                <div class="routine-item">
                    <div class="routine-time">06:00</div>
                    <div class="routine-title">기상</div>
                </div>
                <div class="routine-item">
                    <div class="routine-time">07:30</div>
                    <div class="routine-title">신문읽기</div>
                </div>
                <div class="routine-item">
                    <div class="routine-time">08:00</div>
                    <div class="routine-title">아침일기</div>
                </div>
                <div class="routine-item">
                    <div class="routine-time">12:00</div>
                    <div class="routine-title">Lunch</div>
                </div>
                <div class="routine-item">
                    <div class="routine-time">13:00</div>
                    <div class="routine-title">Work</div>
                </div>
                <div class="routine-item">
                    <div class="routine-time">19:00</div>
                    <div class="routine-title">Free Time</div>
                </div>
                <div class="routine-item">
                    <div class="routine-time">23:00</div>
                    <div class="routine-title">Journal</div>
                </div>
                <div class="routine-item">
                    <div class="routine-time">01:00</div>
                    <div class="routine-title">Sleep</div>
                </div>
            </div>

            <!-- 캐릭터 -->
            <div class="character-section">
                <div class="characters">
                    <div class="character">🥰</div>
                    <div class="character">🤗</div>
                    <div class="character">😊</div>
                </div>
            </div>

            <!-- DataBase -->
            <div class="sidebar-section">
                <h3 class="section-title">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <ellipse cx="12" cy="5" rx="9" ry="3"/>
                        <path d="M3 5V19A9 3 0 0 0 21 19V5"/>
                        <path d="M3 12A9 3 0 0 0 21 12"/>
                    </svg>
                    DataBase
                </h3>
                <div class="database-item" onclick="openDatabase('morning')">
                    <svg class="database-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5"/>
                        <line x1="12" y1="1" x2="12" y2="3"/>
                        <line x1="12" y1="21" x2="12" y2="23"/>
                    </svg>
                    <span class="database-name">Morning</span>
                </div>
                <div class="database-item" onclick="openDatabase('one-line-diary')">
                    <svg class="database-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6A2 2 0 0 0 4 4V20A2 2 0 0 0 6 22H18A2 2 0 0 0 20 20V8Z"/>
                        <polyline points="14,2 14,8 20,8"/>
                    </svg>
                    <span class="database-name">One-Line Diary</span>
                </div>
                <div class="database-item" onclick="openDatabase('todo-list')">
                    <svg class="database-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 11L12 14L22 4"/>
                        <path d="M21 12V19A2 2 0 0 1 19 21H5A2 2 0 0 1 3 19V5A2 2 0 0 1 5 3H16"/>
                    </svg>
                    <span class="database-name">To Do List</span>
                </div>
                <div class="database-item" onclick="openDatabase('habit-tracker')">
                    <svg class="database-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
                        <line x1="8" y1="21" x2="16" y2="21"/>
                        <line x1="12" y1="17" x2="12" y2="21"/>
                    </svg>
                    <span class="database-name">HabitTracker</span>
                </div>
            </div>
        </div>

        <!-- 메인 캘린더 -->
        <div class="main-content">
            <!-- 캘린더 헤더 -->
            <div class="calendar-header">
                <div class="calendar-title">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                        <line x1="16" y1="2" x2="16" y2="6"/>
                        <line x1="8" y1="2" x2="8" y2="6"/>
                        <line x1="3" y1="10" x2="21" y2="10"/>
                    </svg>
                    To Do List
                    <span class="notion-badge">Notion 캘린더에서 열기</span>
                </div>
                <div class="calendar-nav">
                    <button class="nav-button" onclick="previousMonth()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="15,18 9,12 15,6"/>
                        </svg>
                    </button>
                    <div class="month-year" id="monthYear">2025년 1월</div>
                    <button class="nav-button" onclick="nextMonth()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="9,18 15,12 9,6"/>
                        </svg>
                    </button>
                    <button class="nav-button" onclick="goToToday()">오늘</button>
                </div>
            </div>

            <!-- 캘린더 그리드 -->
            <div class="calendar-grid">
                <div class="calendar-weekdays">
                    <div class="weekday">일</div>
                    <div class="weekday">월</div>
                    <div class="weekday">화</div>
                    <div class="weekday">수</div>
                    <div class="weekday">목</div>
                    <div class="weekday">금</div>
                    <div class="weekday">토</div>
                </div>
                <div class="calendar-days" id="calendarDays">
                    <!-- 동적으로 생성됨 -->
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentDate = new Date();
        let currentYear = currentDate.getFullYear();
        let currentMonth = currentDate.getMonth();

        // 샘플 이벤트 데이터
        const events = {
            '2025-01-01': [
                { id: 1, title: 'Task2', subtitle: '오후', type: 'task', completed: false, status: 'D-1일' }
            ],
            '2025-01-08': [
                { id: 2, title: 'Task3', subtitle: '오후', type: 'task', completed: false }
            ],
            '2025-01-14': [
                { id: 3, title: 'Task 1', subtitle: '개인', type: 'task', completed: true, status: 'D-28일' }
            ]
        };

        function generateCalendar(year, month) {
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());

            const calendarDays = document.getElementById('calendarDays');
            calendarDays.innerHTML = '';

            const monthYear = document.getElementById('monthYear');
            monthYear.textContent = `${year}년 ${month + 1}월`;

            const today = new Date();
            today.setHours(0, 0, 0, 0);

            for (let i = 0; i < 42; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);

                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                
                const dayNumber = document.createElement('div');
                dayNumber.className = 'day-number';
                dayNumber.textContent = date.getDate();

                // 오늘 날짜 표시
                if (date.getTime() === today.getTime()) {
                    dayNumber.classList.add('today');
                }

                // 다른 월 날짜 스타일
                if (date.getMonth() !== month) {
                    dayNumber.classList.add('other-month');
                }

                dayElement.appendChild(dayNumber);

                // 이벤트 추가
                const dateStr = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
                if (events[dateStr]) {
                    events[dateStr].forEach(event => {
                        const eventElement = document.createElement('div');
                        eventElement.className = `event ${event.type}${event.completed ? ' completed' : ''}`;
                        
                        const eventTitle = document.createElement('div');
                        eventTitle.className = 'event-title';
                        eventTitle.textContent = event.title;
                        eventElement.appendChild(eventTitle);

                        if (event.subtitle) {
                            const eventSubtitle = document.createElement('div');
                            eventSubtitle.className = 'event-subtitle';
                            eventSubtitle.textContent = event.subtitle;
                            eventElement.appendChild(eventSubtitle);
                        }

                        if (event.status && !event.completed) {
                            const eventStatus = document.createElement('div');
                            eventStatus.className = 'event-subtitle';
                            eventStatus.textContent = event.status;
                            eventElement.appendChild(eventStatus);
                        }

                        if (event.completed) {
                            const doneElement = document.createElement('div');
                            doneElement.className = 'event-done';
                            doneElement.innerHTML = '✓ DONE';
                            eventElement.appendChild(doneElement);
                        }

                        eventElement.addEventListener('click', () => openEvent(event));
                        dayElement.appendChild(eventElement);
                    });
                }

                // Task Dump 추가 (특정 날짜에)
                if (dateStr === '2025-01-27') {
                    const taskDump = document.createElement('div');
                    taskDump.className = 'task-dump';
                    taskDump.innerHTML = '▶ Task Dump';
                    taskDump.addEventListener('click', () => openTaskDump());
                    dayElement.appendChild(taskDump);
                }

                // 추가 버튼
                const addBtn = document.createElement('button');
                addBtn.className = 'add-event-btn';
                addBtn.innerHTML = '+';
                addBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    addEvent(dateStr);
                });
                dayElement.appendChild(addBtn);

                dayElement.addEventListener('click', () => selectDate(dateStr));
                calendarDays.appendChild(dayElement);
            }
        }

        function previousMonth() {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            generateCalendar(currentYear, currentMonth);
        }

        function nextMonth() {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            generateCalendar(currentYear, currentMonth);
        }

        function goToToday() {
            const today = new Date();
            currentYear = today.getFullYear();
            currentMonth = today.getMonth();
            generateCalendar(currentYear, currentMonth);
        }

        function syncCalendar() {
            alert('캘린더 동기화 중...');
        }

        function openSettings() {
            alert('설정 페이지로 이동합니다.');
        }

        function openDatabase(type) {
            alert(`${type} 데이터베이스를 엽니다.`);
        }

        function selectDate(dateStr) {
            console.log('Selected date:', dateStr);
        }

        function addEvent(dateStr) {
            const title = prompt('이벤트 제목을 입력하세요:');
            if (title) {
                if (!events[dateStr]) {
                    events[dateStr] = [];
                }
                events[dateStr].push({
                    id: Date.now(),
                    title: title,
                    type: 'task',
                    completed: false
                });
                generateCalendar(currentYear, currentMonth);
            }
        }

        function openEvent(event) {
            alert(`이벤트: ${event.title}\n상태: ${event.completed ? '완료' : '진행중'}`);
        }

        function openTaskDump() {
            window.location.href = '/task-dump';
        }

        // 초기 캘린더 생성
        generateCalendar(currentYear, currentMonth);
    </script>
</body>
</html>