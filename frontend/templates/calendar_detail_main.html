{% extends "base_dashboard.html" %}

{% block title %}ë‹¬ë ¥{% endblock %}
{% block page_class %}calendar-detail-page{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/calendar-detail.css') }}?v={{ range(100000, 999999) | random }}&t=20250827002&force=1">
<style>
/* Inline CSS to ensure styles are applied - More specific selectors */
body.calendar-detail-page .calendar-detail-container {
    padding: 0 !important;
    max-width: 100% !important;
    margin: 0 !important;
    min-height: 100vh !important;
    background: #f5f6f8 !important;
    display: flex !important;
    flex-direction: column !important;
}

body.calendar-detail-page .calendar-header {
    display: flex !important;
    justify-content: space-between !important;
    align-items: center !important;
    padding: 20px 24px !important;
    border-bottom: 1px solid #e5e5e5 !important;
    background: white !important;
}

body.calendar-detail-page .page-title {
    font-size: 24px !important;
    font-weight: 600 !important;
    color: #333 !important;
    margin: 0 !important;
}

body.calendar-detail-page .calendars-section {
    margin-bottom: 20px !important;
    padding: 20px 24px !important;
    background: white !important;
    border-bottom: 1px solid #e5e5e5 !important;
}

body.calendar-detail-page .calendar-main {
    background: white !important;
    border-radius: 12px !important;
    padding: 16px !important;
    margin: 0 24px 24px !important;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08) !important;
    overflow: hidden !important;
    flex: 1 !important;
}

/* Header controls styling */
body.calendar-detail-page .header-controls {
    display: flex !important;
    align-items: center !important;
    gap: 12px !important;
}

body.calendar-detail-page .btn-attendees {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    width: 36px !important;
    height: 36px !important;
    background: #f8f9fa !important;
    border: 1px solid #e9ecef !important;
    border-radius: 8px !important;
    cursor: pointer !important;
    transition: all 0.2s ease !important;
    color: #495057 !important;
}

body.calendar-detail-page .btn-attendees:hover {
    background: #e9ecef !important;
    border-color: #dee2e6 !important;
    color: #343a40 !important;
}

/* Attendees popup styling */
body.calendar-detail-page .attendees-popup-overlay {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 100% !important;
    height: 100% !important;
    background: rgba(0, 0, 0, 0.5) !important;
    z-index: 1000 !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
}

body.calendar-detail-page .attendees-popup {
    background: white !important;
    border-radius: 12px !important;
    width: 400px !important;
    max-height: 600px !important;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15) !important;
    overflow: hidden !important;
}

body.calendar-detail-page .popup-header {
    padding: 20px 24px !important;
    border-bottom: 1px solid #e9ecef !important;
    display: flex !important;
    justify-content: space-between !important;
    align-items: center !important;
    background: #f8f9fa !important;
}

body.calendar-detail-page .popup-header h3 {
    margin: 0 !important;
    font-size: 18px !important;
    font-weight: 600 !important;
    color: #333 !important;
}

body.calendar-detail-page .popup-close {
    background: none !important;
    border: none !important;
    font-size: 24px !important;
    cursor: pointer !important;
    color: #6c757d !important;
    padding: 0 !important;
    width: 24px !important;
    height: 24px !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
}

body.calendar-detail-page .popup-close:hover {
    color: #495057 !important;
}

body.calendar-detail-page .popup-body {
    padding: 16px 24px !important;
    max-height: 400px !important;
    overflow-y: auto !important;
}

body.calendar-detail-page .attendee-item {
    display: flex !important;
    align-items: center !important;
    padding: 12px 0 !important;
    border-bottom: 1px solid #f1f3f4 !important;
    gap: 12px !important;
}

body.calendar-detail-page .attendee-item:last-child {
    border-bottom: none !important;
}

body.calendar-detail-page .attendee-avatar {
    width: 36px !important;
    height: 36px !important;
    border-radius: 50% !important;
    background: #007bff !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    color: white !important;
    font-weight: 600 !important;
    font-size: 14px !important;
}

body.calendar-detail-page .attendee-info {
    flex: 1 !important;
}

body.calendar-detail-page .attendee-name {
    font-weight: 500 !important;
    color: #333 !important;
    font-size: 14px !important;
    margin-bottom: 2px !important;
}

body.calendar-detail-page .attendee-email {
    color: #6c757d !important;
    font-size: 12px !important;
}

body.calendar-detail-page .attendee-status {
    display: flex !important;
    align-items: center !important;
    gap: 6px !important;
}

body.calendar-detail-page .status-indicator {
    width: 8px !important;
    height: 8px !important;
    border-radius: 50% !important;
    background: #28a745 !important;
}

body.calendar-detail-page .status-owner .status-indicator {
    background: #ffc107 !important;
}

body.calendar-detail-page .status-accepted .status-indicator {
    background: #28a745 !important;
}

body.calendar-detail-page .status-pending .status-indicator {
    background: #6c757d !important;
}

body.calendar-detail-page .status-declined .status-indicator {
    background: #dc3545 !important;
}

body.calendar-detail-page .status-text {
    font-size: 12px !important;
    color: #6c757d !important;
}

body.calendar-detail-page .attendees-summary {
    margin-top: 16px !important;
    padding-top: 16px !important;
    border-top: 1px solid #e9ecef !important;
}

body.calendar-detail-page .summary-stats {
    display: grid !important;
    grid-template-columns: repeat(4, 1fr) !important;
    gap: 12px !important;
}

body.calendar-detail-page .stat-item {
    text-align: center !important;
}

body.calendar-detail-page .stat-label {
    display: block !important;
    font-size: 11px !important;
    color: #6c757d !important;
    margin-bottom: 4px !important;
}

body.calendar-detail-page .stat-value {
    display: block !important;
    font-size: 16px !important;
    font-weight: 600 !important;
    color: #333 !important;
}

body.calendar-detail-page .stat-value.accepted {
    color: #28a745 !important;
}

body.calendar-detail-page .stat-value.pending {
    color: #6c757d !important;
}

body.calendar-detail-page .stat-value.declined {
    color: #dc3545 !important;
}

body.calendar-detail-page .popup-footer {
    padding: 16px 24px !important;
    border-top: 1px solid #e9ecef !important;
    background: #f8f9fa !important;
}

body.calendar-detail-page .btn-add-attendee {
    width: 100% !important;
    padding: 10px 16px !important;
    background: #007bff !important;
    color: white !important;
    border: none !important;
    border-radius: 8px !important;
    font-weight: 500 !important;
    cursor: pointer !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    gap: 8px !important;
    transition: background-color 0.2s ease !important;
}

body.calendar-detail-page .btn-add-attendee:hover {
    background: #0056b3 !important;
}
</style>
{% endblock %}

{% block content %}
<div class="calendar-detail-container">
    <!-- í—¤ë” ì„¹ì…˜ -->
    <div class="calendar-header">
        <div class="header-left">
            <h1 class="page-title">ë‹¬ë ¥</h1>
            <div class="date-info">
                <span id="current-month-year"></span>
            </div>
        </div>
        <div class="header-right">
            <div class="calendar-controls">
                <button class="btn-calendar-nav" id="prev-month" onclick="navigateMonth(-1)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="15,18 9,12 15,6"></polyline>
                    </svg>
                </button>
                <button class="btn-today" onclick="goToToday()">ì˜¤ëŠ˜</button>
                <button class="btn-calendar-nav" id="next-month" onclick="navigateMonth(1)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9,18 15,12 9,6"></polyline>
                    </svg>
                </button>
            </div>
            <div class="header-controls">
                <button class="btn-attendees" id="attendees-btn" onclick="toggleAttendeesPopup()" title="ì°¸ì„ì">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                </button>
                <div class="view-controls">
                    <button class="btn-view active" data-view="month">ì›”</button>
                    <button class="btn-view" data-view="week">ì£¼</button>
                    <button class="btn-view" data-view="day">ì¼</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ì°¸ì„ì íŒì—… -->
    <div class="attendees-popup-overlay" id="attendees-popup" style="display: none;">
        <div class="attendees-popup">
            <div class="popup-header">
                <h3>ì°¸ì„ì</h3>
                <button class="popup-close" onclick="closeAttendeesPopup()">Ã—</button>
            </div>
            <div class="popup-body">
                <div class="attendees-list" id="popup-attendees-list">
                    <!-- Calendar owner -->
                    <div class="attendee-item" data-status="owner">
                        <div class="attendee-avatar">
                            <span class="avatar-text">J</span>
                        </div>
                        <div class="attendee-info">
                            <div class="attendee-name">ì¡°í˜„ì‘ (ì†Œìœ ì)</div>
                            <div class="attendee-email">johyeon-ung@example.com</div>
                        </div>
                        <div class="attendee-status status-owner">
                            <span class="status-indicator"></span>
                            <span class="status-text">ì†Œìœ ì</span>
                        </div>
                    </div>
                    
                    <!-- Sample attendee -->
                    <div class="attendee-item" data-status="accepted">
                        <div class="attendee-avatar">
                            <span class="avatar-text">ê¹€</span>
                        </div>
                        <div class="attendee-info">
                            <div class="attendee-name">ê¹€ë¯¼ìˆ˜</div>
                            <div class="attendee-email">kim@example.com</div>
                        </div>
                        <div class="attendee-status status-accepted">
                            <span class="status-indicator"></span>
                            <span class="status-text">ì°¸ì„</span>
                        </div>
                    </div>
                </div>
                
                <div class="attendees-summary">
                    <div class="summary-stats">
                        <div class="stat-item">
                            <span class="stat-label">ì´ ì¸ì›</span>
                            <span class="stat-value" id="popup-total-attendees">2</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">ì°¸ì„</span>
                            <span class="stat-value accepted" id="popup-accepted-count">1</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">ë¯¸ì •</span>
                            <span class="stat-value pending" id="popup-pending-count">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">ë¶ˆì°¸</span>
                            <span class="stat-value declined" id="popup-declined-count">0</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="popup-footer">
                <button class="btn-add-attendee" onclick="openAddAttendeeModal()">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19" />
                        <line x1="5" y1="12" x2="19" y2="12" />
                    </svg>
                    ì°¸ì„ì ì¶”ê°€
                </button>
            </div>
        </div>
    </div>

    <!-- ìº˜ë¦°ë” ëª©ë¡ ì„¹ì…˜ -->
    <div class="calendars-section">
        <h3 class="section-title">ë‚´ ìº˜ë¦°ë”</h3>
        <div class="calendars-list" id="calendars-list">
            {% if calendars %}
                {% for calendar in calendars %}
                <div class="calendar-item" data-calendar-id="{{ calendar.id }}">
                    <div class="calendar-checkbox">
                        <input type="checkbox" 
                               id="calendar-{{ calendar.id }}" 
                               checked 
                               onchange="toggleCalendar('{{ calendar.id }}', this.checked)">
                    </div>
                    <div class="calendar-color" style="background-color: {{ calendar.color }}"></div>
                    <div class="calendar-info">
                        <span class="calendar-name">{{ calendar.name }}</span>
                        <span class="calendar-events-count">{{ calendar.event_count | default(0) }}ê°œ ì´ë²¤íŠ¸</span>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="no-calendars">
                    <p>ìƒì„±ëœ ìº˜ë¦°ë”ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                    <button class="btn-create-calendar" onclick="window.location.href='/dashboard/calendar-list'">
                        ìº˜ë¦°ë” ìƒì„±í•˜ê¸°
                    </button>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- ë©”ì¸ ìº˜ë¦°ë” ë·° -->
    <div class="calendar-main">
        <div class="calendar-view-container">
            <!-- ì›”ë³„ ë·° -->
            <div class="calendar-view active" id="month-view">
                <div class="calendar-header-row">
                    <div class="calendar-weekday">ì¼</div>
                    <div class="calendar-weekday">ì›”</div>
                    <div class="calendar-weekday">í™”</div>
                    <div class="calendar-weekday">ìˆ˜</div>
                    <div class="calendar-weekday">ëª©</div>
                    <div class="calendar-weekday">ê¸ˆ</div>
                    <div class="calendar-weekday">í† </div>
                </div>
                <div class="calendar-grid" id="calendar-grid">
                    <!-- Calendar cells will be generated here by JavaScript -->
                </div>
            </div>

            <!-- ì£¼ë³„ ë·° (ìˆ¨ê¹€) -->
            <div class="calendar-view" id="week-view">
                <div class="week-container">
                    <!-- Week view will be implemented later -->
                </div>
            </div>

            <!-- ì¼ë³„ ë·° (ìˆ¨ê¹€) -->
            <div class="calendar-view" id="day-view">
                <div class="day-container">
                    <!-- Day view will be implemented later -->
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ì´ë²¤íŠ¸ ìƒì„¸ ëª¨ë‹¬ -->
<div class="event-modal-overlay" id="event-modal" style="display: none;">
    <div class="event-modal">
        <div class="modal-header">
            <h3 id="event-modal-title">ì´ë²¤íŠ¸ ìƒì„¸</h3>
            <button class="modal-close" onclick="closeEventModal()">Ã—</button>
        </div>
        <div class="modal-body" id="event-modal-body">
            <!-- Event details will be populated here -->
        </div>
        <div class="modal-footer">
            <button class="btn-secondary" onclick="closeEventModal()">ë‹«ê¸°</button>
            <button class="btn-primary" onclick="editEvent()">í¸ì§‘</button>
        </div>
    </div>
</div>

<script>
// JavaScriptì—ì„œ ì‚¬ìš©í•  ë°ì´í„° ì„¤ì •
const CALENDAR_DATA = {
    calendars: {{ calendars | tojson if calendars else [] }},
    events: {{ all_events | tojson if all_events else [] }},
    currentDate: '{{ current_date }}'
};

// í˜„ì¬ í‘œì‹œ ì¤‘ì¸ ë‹¬ë ¥ë“¤ (ì²´í¬ë°•ìŠ¤ ìƒíƒœ ê´€ë¦¬)
let visibleCalendars = new Set();
CALENDAR_DATA.calendars.forEach(cal => visibleCalendars.add(cal.id));

// í˜„ì¬ ë·° ìƒíƒœ
let currentView = 'month';
let currentDate = new Date();

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
document.addEventListener('DOMContentLoaded', function() {
    console.log('ğŸ¯ [CRITICAL] Calendar page loaded - starting initialization');
    console.log('ğŸ¯ [CRITICAL] CALENDAR_DATA exists:', typeof CALENDAR_DATA !== 'undefined');
    if (typeof CALENDAR_DATA !== 'undefined') {
        console.log('ğŸ¯ [CRITICAL] CALENDAR_DATA content:', CALENDAR_DATA);
    } else {
        console.error('âŒ [CRITICAL] CALENDAR_DATA is undefined!');
    }
    
    initializeCalendar();
    generateCalendarView();
    updateDateDisplay();
});

// ìº˜ë¦°ë” ì´ˆê¸°í™”
function initializeCalendar() {
    console.log('Initializing calendar with data:', CALENDAR_DATA);
    console.log(`[DEBUG] Total calendars: ${CALENDAR_DATA.calendars.length}`);
    console.log(`[DEBUG] Total events: ${CALENDAR_DATA.events.length}`);
    console.log(`[DEBUG] Current date: ${CALENDAR_DATA.currentDate}`);
    
    if (CALENDAR_DATA.events.length > 0) {
        console.log(`[DEBUG] Sample event structure:`, CALENDAR_DATA.events[0]);
        console.log(`[DEBUG] All event dates:`, CALENDAR_DATA.events.map(e => e.date));
        
        // 12ì›” ì´ë²¤íŠ¸ í™•ì¸
        const decemberEvents = CALENDAR_DATA.events.filter(e => e.date && e.date.startsWith('2025-12'));
        console.log(`[DEBUG] December 2025 events: ${decemberEvents.length}`);
        if (decemberEvents.length > 0) {
            console.log(`[DEBUG] December event dates:`, decemberEvents.map(e => e.date));
            console.log(`[DEBUG] SOLUTION: Navigate to December 2025 to see your events!`);
        }
    }
    
    // ë·° ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
    document.querySelectorAll('.btn-view').forEach(btn => {
        btn.addEventListener('click', () => switchView(btn.dataset.view));
    });
}

// ë‹¬ë ¥ ë·° ìƒì„±
function generateCalendarView() {
    if (currentView === 'month') {
        generateMonthView();
    }
}

// ì›”ë³„ ë·° ìƒì„±
function generateMonthView() {
    const grid = document.getElementById('calendar-grid');
    if (!grid) return;

    const year = currentDate.getFullYear();
    const month = currentDate.getMonth();
    
    // ì²« ë²ˆì§¸ ë‚ ê³¼ ë§ˆì§€ë§‰ ë‚  ê³„ì‚°
    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    const startDate = new Date(firstDay);
    startDate.setDate(startDate.getDate() - firstDay.getDay()); // ì£¼ ì‹œì‘ì¼ë¡œ ì¡°ì •
    
    grid.innerHTML = '';
    
    // Grid ìŠ¤íƒ€ì¼ ê°•ì œ ì ìš© (JavaScriptë¡œ ì¬ì„¤ì • ë°©ì§€)
    grid.style.display = 'grid';
    grid.style.gridTemplateColumns = 'repeat(7, 1fr)';
    grid.style.gridTemplateRows = 'repeat(6, 130px)';
    grid.style.gridAutoRows = '130px'; // ì¶”ê°€ í–‰ë„ 130px
    grid.style.minHeight = '785px'; // 130px * 6 + 5px = 785px
    grid.style.maxHeight = '785px';
    grid.style.height = '785px'; // ì •í™•íˆ 785pxë¡œ ê³ ì •
    
    // 6ì£¼ ìƒì„± (42ì¼)
    for (let i = 0; i < 42; i++) {
        const cellDate = new Date(startDate);
        cellDate.setDate(startDate.getDate() + i);
        
        const cell = createCalendarCell(cellDate, month);
        grid.appendChild(cell);
    }
}

// ìº˜ë¦°ë” ì…€ ìƒì„±
function createCalendarCell(date, currentMonth) {
    const cell = document.createElement('div');
    cell.className = 'calendar-cell';
    
    const isCurrentMonth = date.getMonth() === currentMonth;
    const isToday = isDateToday(date);
    
    if (!isCurrentMonth) {
        cell.classList.add('other-month');
    }
    if (isToday) {
        cell.classList.add('today');
    }
    
    // ë‚ ì§œ í‘œì‹œ
    const dayNumber = document.createElement('div');
    dayNumber.className = 'day-number';
    dayNumber.textContent = date.getDate();
    cell.appendChild(dayNumber);
    
    // ì´ë²¤íŠ¸ í‘œì‹œ (í•­ìƒ container ìƒì„±í•˜ì—¬ ì¼ì •í•œ í¬ê¸° ìœ ì§€)
    const events = getEventsForDate(date);
    const eventsContainer = document.createElement('div');
    eventsContainer.className = 'events-container';
    
    console.log(`[DEBUG] Cell for ${date.toISOString().split('T')[0]} has ${events.length} events`);
    
    if (events.length > 0) {
        console.log(`[DEBUG] Creating ${events.length} event elements for date ${date.toISOString().split('T')[0]}`);
        events.slice(0, 6).forEach((event, index) => { // ìµœëŒ€ 6ê°œê¹Œì§€ í‘œì‹œ (3ê°œ â†’ 6ê°œë¡œ í™•ì¥)
            console.log(`[DEBUG] Creating event element ${index + 1}:`, event);
            const eventElement = createEventElement(event);
            eventsContainer.appendChild(eventElement);
        });
        
        if (events.length > 6) {
            const moreElement = document.createElement('div');
            moreElement.className = 'more-events';
            moreElement.textContent = `+${events.length - 6}ê°œ ë”`;
            eventsContainer.appendChild(moreElement);
        }
    } else {
        console.log(`[DEBUG] No events for date ${date.toISOString().split('T')[0]}`);
    }
    
    // ì´ë²¤íŠ¸ ìœ ë¬´ì™€ ê´€ê³„ì—†ì´ í•­ìƒ ì»¨í…Œì´ë„ˆ ì¶”ê°€
    cell.appendChild(eventsContainer);
    
    // í´ë¦­ ì´ë²¤íŠ¸
    cell.addEventListener('click', () => handleCellClick(date));
    
    return cell;
}

// ì´ë²¤íŠ¸ ìš”ì†Œ ìƒì„±
function createEventElement(event) {
    const eventElement = document.createElement('div');
    eventElement.className = 'event-item';
    eventElement.style.backgroundColor = event.calendar_color;
    eventElement.textContent = event.title;
    
    eventElement.addEventListener('click', (e) => {
        e.stopPropagation();
        showEventModal(event);
    });
    
    return eventElement;
}

// íŠ¹ì • ë‚ ì§œì˜ ì´ë²¤íŠ¸ ê°€ì ¸ì˜¤ê¸°
function getEventsForDate(date) {
    const dateString = date.toISOString().split('T')[0];
    
    // 9ì›” 23ì¼ë§Œ ìì„¸íˆ ë¡œê·¸
    if (dateString === '2025-09-23') {
        console.log(`[DEBUG] Getting events for TODAY: ${dateString}`);
        console.log(`[DEBUG] Available events:`, CALENDAR_DATA.events.length);
        console.log(`[DEBUG] Visible calendars:`, Array.from(visibleCalendars));
        
        const septEvents = CALENDAR_DATA.events.filter(e => e.date && e.date.startsWith('2025-09'));
        console.log(`[DEBUG] September events in data:`, septEvents);
        
        septEvents.forEach((event, i) => {
            console.log(`[DEBUG] Sept Event ${i+1}: title="${event.title}", date="${event.date}", calendar_id="${event.calendar_id}"`);
            console.log(`[DEBUG] Calendar visible for this event: ${visibleCalendars.has(event.calendar_id)}`);
        });
    }
    
    const filteredEvents = CALENDAR_DATA.events.filter(event => {
        if (!visibleCalendars.has(event.calendar_id)) return false;
        return event.date === dateString;
    });
    
    if (dateString === '2025-09-23') {
        console.log(`[DEBUG] Filtered events for TODAY ${dateString}:`, filteredEvents);
    }
    return filteredEvents;
}

// ì˜¤ëŠ˜ ë‚ ì§œì¸ì§€ í™•ì¸
function isDateToday(date) {
    const today = new Date();
    return date.getDate() === today.getDate() &&
           date.getMonth() === today.getMonth() &&
           date.getFullYear() === today.getFullYear();
}

// ì›” ë„¤ë¹„ê²Œì´ì…˜
function navigateMonth(direction) {
    currentDate.setMonth(currentDate.getMonth() + direction);
    generateCalendarView();
    updateDateDisplay();
}

// ì˜¤ëŠ˜ë¡œ ì´ë™
function goToToday() {
    currentDate = new Date();
    generateCalendarView();
    updateDateDisplay();
}

// ë‚ ì§œ í‘œì‹œ ì—…ë°ì´íŠ¸
function updateDateDisplay() {
    const monthYearElement = document.getElementById('current-month-year');
    if (monthYearElement) {
        const options = { year: 'numeric', month: 'long' };
        monthYearElement.textContent = currentDate.toLocaleDateString('ko-KR', options);
    }
}

// ë·° ì „í™˜
function switchView(view) {
    currentView = view;
    
    // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
    document.querySelectorAll('.btn-view').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.view === view) {
            btn.classList.add('active');
        }
    });
    
    // ë·° ì „í™˜
    document.querySelectorAll('.calendar-view').forEach(viewElement => {
        viewElement.classList.remove('active');
    });
    document.getElementById(view + '-view').classList.add('active');
    
    generateCalendarView();
}

// ìº˜ë¦°ë” í† ê¸€
function toggleCalendar(calendarId, isVisible) {
    if (isVisible) {
        visibleCalendars.add(calendarId);
    } else {
        visibleCalendars.delete(calendarId);
    }
    generateCalendarView(); // ë·° ìƒˆë¡œê³ ì¹¨
}

// ì…€ í´ë¦­ í•¸ë“¤ëŸ¬
function handleCellClick(date) {
    console.log('Cell clicked:', date);
    // ë‚ ì§œ í´ë¦­ ì‹œ ì´ë²¤íŠ¸ ìƒì„± ëª¨ë‹¬ ë˜ëŠ” ê¸°íƒ€ ì•¡ì…˜
}

// ì´ë²¤íŠ¸ ëª¨ë‹¬ í‘œì‹œ
function showEventModal(event) {
    const modal = document.getElementById('event-modal');
    const title = document.getElementById('event-modal-title');
    const body = document.getElementById('event-modal-body');
    
    title.textContent = event.title;
    body.innerHTML = `
        <div class="event-detail">
            <div class="detail-row">
                <span class="detail-label">ë‚ ì§œ:</span>
                <span class="detail-value">${event.date}</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">ì‹œê°„:</span>
                <span class="detail-value">${event.start_time || 'ì¢…ì¼'} - ${event.end_time || ''}</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">ìº˜ë¦°ë”:</span>
                <span class="detail-value">${event.calendar_name}</span>
            </div>
            ${event.description ? `
            <div class="detail-row">
                <span class="detail-label">ì„¤ëª…:</span>
                <span class="detail-value">${event.description}</span>
            </div>
            ` : ''}
        </div>
    `;
    
    modal.style.display = 'flex';
}

// ì´ë²¤íŠ¸ ëª¨ë‹¬ ë‹«ê¸°
function closeEventModal() {
    document.getElementById('event-modal').style.display = 'none';
}

// ì´ë²¤íŠ¸ í¸ì§‘ (ì¶”í›„ êµ¬í˜„)
function editEvent() {
    console.log('Edit event clicked');
    closeEventModal();
}

// ì°¸ì„ì íŒì—… í† ê¸€
function toggleAttendeesPopup() {
    const popup = document.getElementById('attendees-popup');
    if (popup.style.display === 'none' || popup.style.display === '') {
        popup.style.display = 'flex';
    } else {
        popup.style.display = 'none';
    }
}

// ì°¸ì„ì íŒì—… ë‹«ê¸°
function closeAttendeesPopup() {
    document.getElementById('attendees-popup').style.display = 'none';
}

// ì°¸ì„ì ì¶”ê°€ ëª¨ë‹¬ ì—´ê¸° (ê¸°ì¡´ í•¨ìˆ˜ ì°¸ì¡°)
function openAddAttendeeModal() {
    console.log('Open add attendee modal');
    // ê¸°ì¡´ calendar_detail.htmlì˜ ì°¸ì„ì ì¶”ê°€ ëª¨ë‹¬ê³¼ ì—°ë™
}

// íŒì—… ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
document.addEventListener('click', function(event) {
    const popup = document.getElementById('attendees-popup');
    const btn = document.getElementById('attendees-btn');
    
    if (popup && popup.style.display === 'flex') {
        if (!popup.contains(event.target) && !btn.contains(event.target)) {
            closeAttendeesPopup();
        }
    }
});
</script>
{% endblock %}