{% extends "base_dashboard.html" %}

{% block title %}API Keys - NotionFlow{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/api-keys-redesign.css') }}?v={{ range(100000, 999999) | random }}">
{% endblock %}

{% block content %}
<!-- API 키 관리 메인 컨테이너 -->
<div class="api-container">
    
    <!-- 헤더 섹션 -->
    <div class="api-header-container">
        <div class="api-header">
            <div class="api-title-section">
                <h1 class="api-main-title">🔑 API 키 관리</h1>
                <p class="api-subtitle">플랫폼과 안전하게 연결하고 캘린더를 동기화하세요</p>
            </div>
            
            <!-- 상태 요약 카드 -->
            <div class="api-status-cards">
                <div class="status-card active">
                    <div class="status-number" id="connected-count">0</div>
                    <div class="status-label">연결된 플랫폼</div>
                </div>
                <div class="status-card">
                    <div class="status-number" id="sync-count">0</div>
                    <div class="status-label">동기화된 이벤트</div>
                </div>
                <div class="status-card">
                    <div class="status-number success" id="success-rate">100%</div>
                    <div class="status-label">성공률</div>
                </div>
            </div>
        </div>
    </div>

    <!-- 플랫폼 연결 섹션 -->
    <div class="platforms-section">
        
        <!-- Notion 연결 카드 -->
        <div class="platform-card" data-platform="notion">
            <div class="platform-header">
                <div class="platform-info">
                    <div class="platform-icon notion">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M4.459 4.208c.746.606 1.026.56 2.428.466l13.215-.793c.28 0 .047-.28-.046-.326L17.86 1.968c-.42-.326-.981-.7-2.055-.607L3.01 2.295c-.466.046-.56.28-.374.466zm.793 3.08v13.904c0 .747.373 1.027 1.214.98l14.523-.84c.841-.046 1.121-.56 1.121-1.167V6.354c0-.606-.233-.933-.747-.887l-15.177.887c-.56.047-.934.373-.934 1.027zm13.748.327c.093.42 0 .84-.42.888l-.7.14v10.264c-.608.327-1.168.514-1.635.514-.748 0-.935-.234-1.495-.933l-4.577-7.186v6.952L12.21 19s0 .84-1.168.84l-3.222.186c-.093-.186 0-.653.327-.746l.84-.233V9.854L7.822 9.76c-.094-.42.14-1.026.793-1.073l3.456-.233 4.764 7.279v-6.44l-1.215-.139c-.093-.514.28-.887.747-.933z"/>
                        </svg>
                    </div>
                    <div class="platform-details">
                        <h3 class="platform-name">Notion</h3>
                        <p class="platform-description">페이지와 데이터베이스를 캘린더로 동기화</p>
                        <div class="platform-status disconnected">
                            <span class="status-dot"></span>
                            연결되지 않음
                        </div>
                    </div>
                </div>
                <button class="platform-action-btn" onclick="togglePlatformDetails('notion')">
                    <span class="btn-text">연결하기</span>
                    <svg class="expand-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M6 9l6 6 6-6"/>
                    </svg>
                </button>
            </div>
            
            <!-- 연결 상세 폼 -->
            <div class="platform-details-form" id="notion-details" style="display: none;">
                <div class="form-group">
                    <label for="notion-token">Internal Integration Token</label>
                    <input type="password" id="notion-token" name="notion-token" placeholder="secret_으로 시작하는 토큰을 입력하세요">
                    <small class="form-help">
                        <a href="https://www.notion.so/my-integrations" target="_blank" class="help-link">
                            📖 토큰 발급받기
                        </a>
                        | 페이지 접근 권한 필요
                    </small>
                </div>
                <div class="form-actions">
                    <button class="btn btn-secondary" onclick="togglePlatformDetails('notion')">취소</button>
                    <button class="btn btn-primary" onclick="connectPlatform('notion')">
                        <span class="loading-spinner" style="display: none;"></span>
                        연결하기
                    </button>
                </div>
            </div>
        </div>

        <!-- Google Calendar 연결 카드 -->
        <div class="platform-card" data-platform="google">
            <div class="platform-header">
                <div class="platform-info">
                    <div class="platform-icon google">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/>
                        </svg>
                    </div>
                    <div class="platform-details">
                        <h3 class="platform-name">Google Calendar</h3>
                        <p class="platform-description">구글 캘린더와 실시간 동기화</p>
                        <div class="platform-status connected">
                            <span class="status-dot"></span>
                            연결됨
                        </div>
                    </div>
                </div>
                <button class="platform-action-btn connected" onclick="disconnectPlatform('google')">
                    <span class="btn-text">연결 해제</span>
                </button>
            </div>
        </div>

        <!-- Apple Calendar 연결 카드 -->
        <div class="platform-card" data-platform="apple">
            <div class="platform-header">
                <div class="platform-info">
                    <div class="platform-icon apple">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19.5 4h-1.44a2.04 2.04 0 0 0-1.98 1.22l-1.58 4.49c-.25.7-.91 1.16-1.65 1.16-.73 0-1.39-.46-1.64-1.16l-1.58-4.49A2.04 2.04 0 0 0 7.62 4H6.5C5.67 4 5 4.67 5 5.5S5.67 7 6.5 7h1.12c.14 0 .27.09.32.22l1.58 4.49c.5 1.4 1.82 2.29 3.31 2.29s2.81-.89 3.31-2.29L17.72 7.22c.05-.13.18-.22.32-.22H19.5c.83 0 1.5-.67 1.5-1.5S20.33 4 19.5 4z"/>
                        </svg>
                    </div>
                    <div class="platform-details">
                        <h3 class="platform-name">Apple Calendar</h3>
                        <p class="platform-description">iCloud 캘린더와 동기화</p>
                        <div class="platform-status disconnected">
                            <span class="status-dot"></span>
                            연결되지 않음
                        </div>
                    </div>
                </div>
                <button class="platform-action-btn" onclick="togglePlatformDetails('apple')">
                    <span class="btn-text">연결하기</span>
                    <svg class="expand-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M6 9l6 6 6-6"/>
                    </svg>
                </button>
            </div>
            
            <!-- 연결 상세 폼 -->
            <div class="platform-details-form" id="apple-details" style="display: none;">
                <div class="form-group">
                    <label for="apple-username">Apple ID</label>
                    <input type="email" id="apple-username" name="apple-username" placeholder="your-apple-id@icloud.com">
                </div>
                <div class="form-group">
                    <label for="apple-password">앱 전용 암호</label>
                    <input type="password" id="apple-password" name="apple-password" placeholder="앱 전용 암호">
                    <small class="form-help">
                        <a href="https://support.apple.com/en-us/HT204397" target="_blank" class="help-link">
                            📖 앱 전용 암호 만들기
                        </a>
                        | 2단계 인증 필요
                    </small>
                </div>
                <div class="form-actions">
                    <button class="btn btn-secondary" onclick="togglePlatformDetails('apple')">취소</button>
                    <button class="btn btn-primary" onclick="connectPlatform('apple')">
                        <span class="loading-spinner" style="display: none;"></span>
                        연결하기
                    </button>
                </div>
            </div>
        </div>
        
    </div>

    <!-- 보안 및 개인정보 보호 섹션 -->
    <div class="security-section">
        <div class="security-header">
            <h2 class="security-title">🔐 보안 및 개인정보</h2>
            <p class="security-subtitle">모든 연결과 데이터는 최고 수준의 보안으로 보호됩니다</p>
        </div>
        
        <div class="security-features">
            <div class="security-feature">
                <div class="feature-icon">🔒</div>
                <div class="feature-content">
                    <h4>엔드투엔드 암호화</h4>
                    <p>모든 API 키와 데이터는 AES-256 암호화로 보호됩니다</p>
                </div>
            </div>
            <div class="security-feature">
                <div class="feature-icon">🚫</div>
                <div class="feature-content">
                    <h4>무로그 정책</h4>
                    <p>개인 캘린더 데이터는 저장하지 않으며 실시간으로만 동기화합니다</p>
                </div>
            </div>
            <div class="security-feature">
                <div class="feature-icon">🛡️</div>
                <div class="feature-content">
                    <h4>읽기 전용 접근</h4>
                    <p>최소 권한 원칙에 따라 필요한 권한만 요청합니다</p>
                </div>
            </div>
        </div>
    </div>

</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/api-keys.js') }}?v={{ range(100000, 999999) | random }}"></script>
{% endblock %}