{% extends "base_dashboard.html" %}

{% block title %}API Keys - NotionFlow{% endblock %}

{% block extra_css %}
<link rel="stylesheet"
    href="{{ url_for('static', filename='css/api-keys-redesign.css') }}?v={{ range(100000, 999999) | random }}">
{% endblock %}

{% block content %}
<!-- API 키 관리 메인 컨테이너 -->
<div class="api-container">

    <!-- 헤더 섹션 -->
    <div class="api-header-container">
        <div class="api-header">
            <div class="api-title-section">
                <h1 class="api-main-title">🔑 API 키 관리</h1>
                <p class="api-subtitle">플랫폼과 안전하게 연결하고 캘린더를 동기화하세요</p>
            </div>
        </div>

        <!-- 상태 요약 카드 -->
        <div class="api-status-cards">
            <div class="status-card active">
                <div class="status-icon">🔗</div>
                <div class="status-content">
                    <div class="status-number" id="connected-count">0</div>
                    <div class="status-label">연결된 플랫폼</div>
                </div>
            </div>
            <div class="status-card">
                <div class="status-icon">📅</div>
                <div class="status-content">
                    <div class="status-number" id="sync-count">0</div>
                    <div class="status-label">동기화된 이벤트</div>
                </div>
            </div>
            <div class="status-card">
                <div class="status-icon">✅</div>
                <div class="status-content">
                    <div class="status-number success" id="success-rate">0%</div>
                    <div class="status-label">성공률</div>
                </div>
            </div>
            <div class="status-card">
                <div class="status-icon">⚡</div>
                <div class="status-content">
                    <div class="status-number" id="sync-speed">N/A</div>
                    <div class="status-label">평균 동기화 시간</div>
                </div>
            </div>
        </div>
    </div>

    <!-- 캘린더 생성 안내 섹션 -->
    <div class="calendar-setup-guide" id="calendar-setup-guide">
        <div class="guide-card">
            <div class="guide-content">
                <h3 class="guide-title">🎯 시작하기 전에</h3>
                <p class="guide-description">
                    플랫폼을 연결하기 전에 먼저 <strong>캘린더를 생성</strong>해야 합니다.<br>
                    캘린더가 있어야 각 플랫폼의 이벤트를 동기화할 수 있어요!
                </p>
                <div class="guide-steps">
                    <div class="step-item">
                        <span class="step-number">1</span>
                        <span class="step-text">캘린더 생성하기</span>
                    </div>
                    <div class="step-item">
                        <span class="step-number">2</span>
                        <span class="step-text">플랫폼 연결하기</span>
                    </div>
                    <div class="step-item">
                        <span class="step-number">3</span>
                        <span class="step-text">자동 동기화 시작</span>
                    </div>
                </div>
                <div class="guide-actions">
                    <a href="/calendar" class="guide-btn primary">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path
                                d="M8 2v4M16 2v4M3 10h18M5 4h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z" />
                        </svg>
                        캘린더 생성하기
                    </a>
                    <button class="guide-btn secondary" onclick="hideCalendarGuide()">
                        나중에 하기
                    </button>
                </div>
            </div>
            <button class="guide-close" onclick="hideCalendarGuide()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 6l-12 12M6 6l12 12" />
                </svg>
            </button>
        </div>
    </div>

    <!-- 플랫폼 연결 섹션 -->
    <div class="platforms-section">

        <!-- Notion 연결 카드 -->
        <div class="platform-card" data-platform="notion">
            <div class="platform-header">
                <div class="platform-info">
                    <div class="platform-icon notion">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M4.459 4.208c.746.606 1.026.56 2.428.466l13.215-.793c.28 0 .047-.28-.046-.326L17.86 1.968c-.42-.326-.981-.7-2.055-.607L3.01 2.295c-.466.046-.56.28-.374.466zm.793 3.08v13.904c0 .747.373 1.027 1.214.98l14.523-.84c.841-.046 1.121-.56 1.121-1.167V6.354c0-.606-.233-.933-.747-.887l-15.177.887c-.56.047-.934.373-.934 1.027zm13.748.327c.093.42 0 .84-.42.888l-.7.14v10.264c-.608.327-1.168.514-1.635.514-.748 0-.935-.234-1.495-.933l-4.577-7.186v6.952L12.21 19s0 .84-1.168.84l-3.222.186c-.093-.186 0-.653.327-.746l.84-.233V9.854L7.822 9.76c-.094-.42.14-1.026.793-1.073l3.456-.233 4.764 7.279v-6.44l-1.215-.139c-.093-.514.28-.887.747-.933z" />
                        </svg>
                    </div>
                    <div class="platform-details">
                        <h3 class="platform-name">Notion</h3>
                        <p class="platform-description">페이지와 데이터베이스를 캘린더로 동기화</p>
                        <div class="platform-status disconnected">
                            <span class="status-dot"></span>
                            연결되지 않음
                        </div>
                    </div>
                </div>
                <div class="platform-actions">
                    <button class="one-click-btn-small" onclick="oneClickConnect('notion')" data-platform="notion">
                        <span class="btn-icon">⚡</span>
                        <span class="btn-text">원클릭</span>
                        <div class="btn-loader" style="display: none;">
                            <div class="loader-spinner"></div>
                        </div>
                    </button>
                    <button class="platform-connect-btn" onclick="connectPlatform('notion')" data-platform="notion">
                        <span class="connect-text">연결하기</span>
                        <div class="connect-loader" style="display: none;">
                            <div class="loader-dot"></div>
                        </div>
                    </button>
                    <button class="platform-expand-btn" onclick="togglePlatformDetails('notion')">
                        <svg class="expand-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M6 9l6 6 6-6" />
                        </svg>
                    </button>
                </div>
            </div>

            <!-- 연결 상세 폼 -->
            <div class="platform-details-form" id="notion-details" style="display: none;">
                <div class="form-group">
                    <label for="notion-token">Internal Integration Token</label>
                    <input type="password" id="notion-token" name="notion-token" placeholder="secret_으로 시작하는 토큰을 입력하세요">
                    <small class="form-help">
                        <a href="https://www.notion.so/my-integrations" target="_blank" class="help-link">
                            📖 토큰 발급받기
                        </a>
                        | 페이지 접근 권한 필요
                    </small>
                </div>
                <div class="form-actions">
                    <button class="btn btn-secondary" onclick="togglePlatformDetails('notion')">취소</button>
                    <button class="btn btn-primary" onclick="connectPlatform('notion')">
                        <span class="loading-spinner" style="display: none;"></span>
                        연결하기
                    </button>
                </div>
            </div>
        </div>

        <!-- Google Calendar 연결 카드 -->
        <div class="platform-card" data-platform="google">
            <div class="platform-header">
                <div class="platform-info">
                    <div class="platform-icon google">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z" />
                        </svg>
                    </div>
                    <div class="platform-details">
                        <h3 class="platform-name">Google Calendar</h3>
                        <p class="platform-description">구글 캘린더와 실시간 동기화</p>
                        <div class="platform-status disconnected">
                            <span class="status-dot"></span>
                            연결되지 않음
                        </div>
                    </div>
                </div>
                <div class="platform-actions">
                    <button class="one-click-btn-small" onclick="oneClickConnect('google')" data-platform="google">
                        <span class="btn-icon">⚡</span>
                        <span class="btn-text">원클릭</span>
                        <div class="btn-loader" style="display: none;">
                            <div class="loader-spinner"></div>
                        </div>
                    </button>
                    <button class="platform-connect-btn" onclick="connectPlatform('google')" data-platform="google">
                        <span class="connect-text">연결하기</span>
                        <div class="connect-loader" style="display: none;">
                            <div class="loader-dot"></div>
                        </div>
                    </button>
                </div>
            </div>
        </div>

        <!-- Apple Calendar 연결 카드 -->
        <div class="platform-card" data-platform="apple">
            <div class="platform-header">
                <div class="platform-info">
                    <div class="platform-icon apple">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M19.5 4h-1.44a2.04 2.04 0 0 0-1.98 1.22l-1.58 4.49c-.25.7-.91 1.16-1.65 1.16-.73 0-1.39-.46-1.64-1.16l-1.58-4.49A2.04 2.04 0 0 0 7.62 4H6.5C5.67 4 5 4.67 5 5.5S5.67 7 6.5 7h1.12c.14 0 .27.09.32.22l1.58 4.49c.5 1.4 1.82 2.29 3.31 2.29s2.81-.89 3.31-2.29L17.72 7.22c.05-.13.18-.22.32-.22H19.5c.83 0 1.5-.67 1.5-1.5S20.33 4 19.5 4z" />
                        </svg>
                    </div>
                    <div class="platform-details">
                        <h3 class="platform-name">Apple Calendar</h3>
                        <p class="platform-description">iCloud 캘린더와 동기화</p>
                        <div class="platform-status disconnected">
                            <span class="status-dot"></span>
                            연결되지 않음
                        </div>
                    </div>
                </div>
                <div class="platform-actions">
                    <button class="one-click-btn-small" onclick="oneClickConnect('apple')" data-platform="apple">
                        <span class="btn-icon">⚡</span>
                        <span class="btn-text">원클릭</span>
                        <div class="btn-loader" style="display: none;">
                            <div class="loader-spinner"></div>
                        </div>
                    </button>
                    <button class="platform-connect-btn" onclick="connectPlatform('apple')" data-platform="apple">
                        <span class="connect-text">연결하기</span>
                        <div class="connect-loader" style="display: none;">
                            <div class="loader-dot"></div>
                        </div>
                    </button>
                    <button class="platform-expand-btn" onclick="togglePlatformDetails('apple')">
                        <svg class="expand-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M6 9l6 6 6-6" />
                        </svg>
                    </button>
                </div>
            </div>

            <!-- 연결 상세 폼 -->
            <div class="platform-details-form" id="apple-details" style="display: none;">
                <div class="form-group">
                    <label for="apple-username">Apple ID</label>
                    <input type="email" id="apple-username" name="apple-username"
                        placeholder="your-apple-id@icloud.com">
                </div>
                <div class="form-group">
                    <label for="apple-password">앱 전용 암호</label>
                    <input type="password" id="apple-password" name="apple-password" placeholder="앱 전용 암호">
                    <small class="form-help">
                        <a href="https://support.apple.com/en-us/HT204397" target="_blank" class="help-link">
                            📖 앱 전용 암호 만들기
                        </a>
                        | 2단계 인증 필요
                    </small>
                </div>
                <div class="form-actions">
                    <button class="btn btn-secondary" onclick="togglePlatformDetails('apple')">취소</button>
                    <button class="btn btn-primary" onclick="connectPlatform('apple')">
                        <span class="loading-spinner" style="display: none;"></span>
                        연결하기
                    </button>
                </div>
            </div>
        </div>

        <!-- Outlook 연결 카드 -->
        <div class="platform-card" data-platform="outlook">
            <div class="platform-header">
                <div class="platform-info">
                    <div class="platform-icon outlook">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M7.88 12.04q0 .45-.11.87-.1.41-.33.74-.22.33-.58.52-.37.2-.87.2-.51 0-.87-.2-.37-.19-.59-.52-.21-.33-.32-.74-.1-.42-.1-.87 0-.44.1-.86.11-.41.32-.73.22-.33.59-.52.36-.2.87-.2.5 0 .87.2.36.19.58.52.23.32.33.73.11.42.11.86zM21.5 4v16q0 .41-.3.7-.29.3-.7.3H3.5q-.41 0-.7-.3-.3-.29-.3-.7V4q0-.41.3-.7Q2.79 3 3.2 3h17.6q.41 0 .7.29.3.29.3.71zM8.5 13.5H7.25v.75H8.5v-.75zm0-3H7.25V11H8.5v-.5zM12 7.98H9v8h3V7.98zm6.5 2.53-2.25 2.02 2.25 2.05V10.51z" />
                        </svg>
                    </div>
                    <div class="platform-details">
                        <h3 class="platform-name">Outlook</h3>
                        <p class="platform-description">Outlook 캘린더와 동기화</p>
                        <div class="platform-status disconnected">
                            <span class="status-dot"></span>
                            연결되지 않음
                        </div>
                    </div>
                </div>
                <div class="platform-actions">
                    <button class="one-click-btn-small" onclick="oneClickConnect('outlook')" data-platform="outlook">
                        <span class="btn-icon">⚡</span>
                        <span class="btn-text">원클릭</span>
                        <div class="btn-loader" style="display: none;">
                            <div class="loader-spinner"></div>
                        </div>
                    </button>
                    <button class="platform-connect-btn" onclick="connectPlatform('outlook')" data-platform="outlook">
                        <span class="connect-text">연결하기</span>
                        <div class="connect-loader" style="display: none;">
                            <div class="loader-dot"></div>
                        </div>
                    </button>
                    <button class="platform-expand-btn" onclick="togglePlatformDetails('outlook')">
                        <svg class="expand-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M6 9l6 6 6-6" />
                        </svg>
                    </button>
                </div>
            </div>

            <!-- 연결 상세 폼 -->
            <div class="platform-details-form" id="outlook-details" style="display: none;">
                <div class="form-group">
                    <label for="outlook-email">Microsoft 계정</label>
                    <input type="email" id="outlook-email" name="outlook-email" placeholder="your-email@outlook.com">
                </div>
                <div class="form-group">
                    <label for="outlook-client-id">클라이언트 ID</label>
                    <input type="text" id="outlook-client-id" name="outlook-client-id"
                        placeholder="Azure 앱 등록에서 발급받은 클라이언트 ID">
                    <small class="form-help">
                        <a href="https://portal.azure.com/" target="_blank" class="help-link">
                            📖 Azure Portal에서 앱 등록하기
                        </a>
                        | Graph API 권한 필요
                    </small>
                </div>
                <div class="form-actions">
                    <button class="btn btn-secondary" onclick="togglePlatformDetails('outlook')">취소</button>
                    <button class="btn btn-primary" onclick="connectPlatform('outlook')">
                        <span class="loading-spinner" style="display: none;"></span>
                        연결하기
                    </button>
                </div>
            </div>
        </div>

        <!-- Slack 연결 카드 -->
        <div class="platform-card" data-platform="slack">
            <div class="platform-header">
                <div class="platform-info">
                    <div class="platform-icon slack">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M5.042 15.165a2.528 2.528 0 0 1-2.52 2.523A2.528 2.528 0 0 1 0 15.165a2.527 2.527 0 0 1 2.522-2.52h2.52v2.52zM6.313 15.165a2.527 2.527 0 0 1 2.521-2.52 2.527 2.527 0 0 1 2.521 2.52v6.313A2.528 2.528 0 0 1 8.834 24a2.528 2.528 0 0 1-2.521-2.522v-6.313zM8.834 5.042a2.528 2.528 0 0 1-2.521-2.52A2.528 2.528 0 0 1 8.834 0a2.528 2.528 0 0 1 2.521 2.522v2.52H8.834zM8.834 6.313a2.528 2.528 0 0 1 2.521 2.521 2.528 2.528 0 0 1-2.521 2.521H2.522A2.528 2.528 0 0 1 0 8.834a2.528 2.528 0 0 1 2.522-2.521h6.312zM18.956 8.834a2.528 2.528 0 0 1 2.521-2.521A2.528 2.528 0 0 1 24 8.834a2.528 2.528 0 0 1-2.523 2.521h-2.521V8.834zM17.688 8.834a2.528 2.528 0 0 1-2.523 2.521 2.527 2.527 0 0 1-2.52-2.521V2.522A2.527 2.527 0 0 1 15.165 0a2.528 2.528 0 0 1 2.523 2.522v6.312zM15.165 18.956a2.528 2.528 0 0 1 2.523 2.521A2.528 2.528 0 0 1 15.165 24a2.527 2.527 0 0 1-2.52-2.523v-2.521h2.52zM15.165 17.688a2.527 2.527 0 0 1-2.52-2.523 2.526 2.526 0 0 1 2.52-2.52h6.313A2.527 2.527 0 0 1 24 15.165a2.528 2.528 0 0 1-2.522 2.523h-6.313z" />
                        </svg>
                    </div>
                    <div class="platform-details">
                        <h3 class="platform-name">Slack</h3>
                        <p class="platform-description">Slack 알림 및 캘린더 연동</p>
                        <div class="platform-status disconnected">
                            <span class="status-dot"></span>
                            연결되지 않음
                        </div>
                    </div>
                </div>
                <div class="platform-actions">
                    <button class="one-click-btn-small" onclick="oneClickConnect('slack')" data-platform="slack">
                        <span class="btn-icon">⚡</span>
                        <span class="btn-text">원클릭</span>
                        <div class="btn-loader" style="display: none;">
                            <div class="loader-spinner"></div>
                        </div>
                    </button>
                    <button class="platform-connect-btn" onclick="connectPlatform('slack')" data-platform="slack">
                        <span class="connect-text">연결하기</span>
                        <div class="connect-loader" style="display: none;">
                            <div class="loader-dot"></div>
                        </div>
                    </button>
                    <button class="platform-expand-btn" onclick="togglePlatformDetails('slack')">
                        <svg class="expand-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M6 9l6 6 6-6" />
                        </svg>
                    </button>
                </div>
            </div>

            <!-- 연결 상세 폼 -->
            <div class="platform-details-form" id="slack-details" style="display: none;">
                <div class="form-group">
                    <label for="slack-webhook">Webhook URL</label>
                    <input type="url" id="slack-webhook" name="slack-webhook"
                        placeholder="https://hooks.slack.com/services/...">
                    <small class="form-help">
                        <a href="https://api.slack.com/messaging/webhooks" target="_blank" class="help-link">
                            📖 Slack Webhook 만들기
                        </a>
                        | 워크스페이스 관리자 권한 필요
                    </small>
                </div>
                <div class="form-actions">
                    <button class="btn btn-secondary" onclick="togglePlatformDetails('slack')">취소</button>
                    <button class="btn btn-primary" onclick="connectPlatform('slack')">
                        <span class="loading-spinner" style="display: none;"></span>
                        연결하기
                    </button>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- 캘린더 선택 모달 -->
<div class="calendar-selection-modal" id="calendar-selection-modal" style="display: none;">
    <div class="modal-overlay" onclick="closeCalendarSelectionModal()"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">캘린더 선택</h3>
            <button class="modal-close-btn" onclick="closeCalendarSelectionModal()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 6l-12 12M6 6l12 12"/>
                </svg>
            </button>
        </div>
        <div class="modal-body">
            <p class="modal-description">
                <span id="platform-name-display"></span> 연결을 위해 동기화할 캘린더를 선택하세요.
            </p>
            <div class="calendar-list" id="calendar-list">
                <div class="loading-state">
                    <div class="loading-spinner"></div>
                    <p>캘린더 목록을 불러오는 중...</p>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-secondary" onclick="closeCalendarSelectionModal()">취소</button>
            <button class="btn-primary" id="confirm-calendar-selection" onclick="confirmCalendarSelection()" disabled>
                선택한 캘린더로 연결
            </button>
        </div>
    </div>
</div>

<style>
/* 캘린더 선택 모달 스타일 */
.calendar-selection-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 999999;
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(4px);
}

.modal-content {
    position: relative;
    background: #ffffff;
    border-radius: 16px;
    max-width: 600px;
    width: 90%;
    max-height: 80vh;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
    overflow: hidden;
}

.modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 24px 32px;
    border-bottom: 1px solid #f0f0f0;
}

.modal-title {
    font-size: 20px;
    font-weight: 600;
    color: #000000;
    margin: 0;
}

.modal-close-btn {
    background: none;
    border: none;
    cursor: pointer;
    padding: 4px;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #6b7280;
    transition: all 0.2s ease;
}

.modal-close-btn:hover {
    background: #f9fafb;
    color: #000000;
}

.modal-body {
    padding: 32px;
    max-height: 400px;
    overflow-y: auto;
}

.modal-description {
    font-size: 16px;
    color: #6b7280;
    margin-bottom: 24px;
    line-height: 1.5;
}

.calendar-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.calendar-item {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 16px;
    border: 2px solid #e5e7eb;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.2s ease;
    background: #ffffff;
}

.calendar-item:hover {
    border-color: #3b82f6;
    background: #f8faff;
}

.calendar-item.selected {
    border-color: #3b82f6;
    background: #eff6ff;
}

.calendar-radio {
    width: 20px;
    height: 20px;
    border: 2px solid #d1d5db;
    border-radius: 50%;
    position: relative;
    flex-shrink: 0;
}

.calendar-item.selected .calendar-radio {
    border-color: #3b82f6;
}

.calendar-item.selected .calendar-radio::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 10px;
    height: 10px;
    background: #3b82f6;
    border-radius: 50%;
}

.calendar-info {
    flex: 1;
}

.calendar-name {
    font-size: 16px;
    font-weight: 500;
    color: #000000;
    margin-bottom: 4px;
}

.calendar-description {
    font-size: 14px;
    color: #6b7280;
}

.calendar-type {
    padding: 4px 8px;
    border-radius: 6px;
    font-size: 12px;
    font-weight: 500;
    text-transform: uppercase;
}

.calendar-type.primary {
    background: #dbeafe;
    color: #1d4ed8;
}

.calendar-type.shared {
    background: #d1fae5;
    color: #047857;
}

.calendar-type.personal {
    background: #fef3c7;
    color: #d97706;
}

.loading-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 16px;
    padding: 40px 20px;
    color: #6b7280;
}

.loading-spinner {
    width: 32px;
    height: 32px;
    border: 3px solid #e5e7eb;
    border-top: 3px solid #3b82f6;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

.modal-footer {
    display: flex;
    gap: 12px;
    padding: 24px 32px;
    border-top: 1px solid #f0f0f0;
    justify-content: flex-end;
}

.btn-secondary, .btn-primary {
    padding: 12px 24px;
    border-radius: 8px;
    font-size: 15px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    border: none;
    min-width: 120px;
}

.btn-secondary {
    background: #ffffff;
    color: #6b7280;
    border: 1px solid #e5e7eb;
}

.btn-secondary:hover {
    background: #f9fafb;
    color: #000000;
}

.btn-primary {
    background: #3b82f6;
    color: #ffffff;
}

.btn-primary:hover:not(:disabled) {
    background: #2563eb;
}

.btn-primary:disabled {
    background: #9ca3af;
    cursor: not-allowed;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
</style>
{% endblock %}

{% block extra_js %}
<!-- Core notification system이 먼저 로드되어야 함 -->
<script
    src="{{ url_for('static', filename='js/notification-utils.js') }}?v={{ range(100000, 999999) | random }}"></script>
<script
    src="{{ url_for('static', filename='js/apple-setup-wizard.js') }}?v={{ range(100000, 999999) | random }}"></script>
<script src="{{ url_for('static', filename='js/platform-health.js') }}?v={{ range(100000, 999999) | random }}"></script>
<script>
    // 현재 연결 중인 플랫폼과 선택된 캘린더를 저장
    let currentConnectingPlatform = null;
    let selectedCalendarId = null;

    // 개별 플랫폼 연동 기능 - 캘린더 선택 후 연결
    async function connectPlatform(platformName) {
        // 먼저 캘린더 선택 모달 표시
        await showCalendarSelectionModal(platformName);
    }

    // 캘린더 선택 모달 표시
    async function showCalendarSelectionModal(platformName) {
        currentConnectingPlatform = platformName;
        const modal = document.getElementById('calendar-selection-modal');
        const platformDisplay = document.getElementById('platform-name-display');
        const calendarList = document.getElementById('calendar-list');
        
        // 플랫폼 이름 표시
        platformDisplay.textContent = getKoreanPlatformName(platformName);
        
        // 모달 표시
        modal.style.display = 'flex';
        
        // 캘린더 목록 로딩
        await loadUserCalendars(calendarList);
    }

    // 사용자 캘린더 목록 로드
    async function loadUserCalendars(calendarListContainer) {
        try {
            // API에서 사용자 캘린더 목록 가져오기
            const response = await fetch('/api/dashboard/calendars');
            
            if (response.ok) {
                const data = await response.json();
                
                if (data.success && data.calendars && data.calendars.length > 0) {
                    displayCalendarList(data.calendars, calendarListContainer);
                } else {
                    // 캘린더가 없으면 생성 안내
                    displayNoCalendarsMessage(calendarListContainer);
                }
            } else {
                // 샘플 캘린더 데이터 표시 (API가 없는 경우)
                displaySampleCalendars(calendarListContainer);
            }
        } catch (error) {
            console.error('캘린더 목록 로드 오류:', error);
            // 에러 시 샘플 데이터 표시
            displaySampleCalendars(calendarListContainer);
        }
    }

    // 캘린더 목록 표시
    function displayCalendarList(calendars, container) {
        container.innerHTML = '';
        
        calendars.forEach(calendar => {
            const calendarItem = createCalendarItem(calendar);
            container.appendChild(calendarItem);
        });
    }

    // 샘플 캘린더 데이터 표시 (API가 없는 경우)
    function displaySampleCalendars(container) {
        const sampleCalendars = [
            {
                id: 'main-calendar',
                name: '메인 캘린더',
                description: '기본 개인 캘린더',
                type: 'primary',
                color: '#3b82f6'
            },
            {
                id: 'work-calendar',
                name: '업무 캘린더',
                description: '업무 관련 일정 관리',
                type: 'personal',
                color: '#f59e0b'
            },
            {
                id: 'shared-calendar',
                name: '팀 공유 캘린더',
                description: '팀원들과 공유하는 캘린더',
                type: 'shared',
                color: '#10b981'
            }
        ];
        
        displayCalendarList(sampleCalendars, container);
    }

    // 캘린더가 없을 때 메시지 표시
    function displayNoCalendarsMessage(container) {
        container.innerHTML = `
            <div class="no-calendars-message">
                <div class="no-calendars-icon">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M8 2v4M16 2v4M3 10h18M5 4h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z"/>
                    </svg>
                </div>
                <h4>캘린더가 없습니다</h4>
                <p>먼저 캘린더를 생성해주세요.</p>
                <button class="btn-primary" onclick="redirectToCalendarCreation()">
                    캘린더 생성하러 가기
                </button>
            </div>
        `;
    }

    // 캘린더 아이템 생성
    function createCalendarItem(calendar) {
        const item = document.createElement('div');
        item.className = 'calendar-item';
        item.setAttribute('data-calendar-id', calendar.id);
        item.onclick = () => selectCalendar(calendar.id);
        
        item.innerHTML = `
            <div class="calendar-radio"></div>
            <div class="calendar-info">
                <div class="calendar-name">${calendar.name}</div>
                <div class="calendar-description">${calendar.description || ''}</div>
            </div>
            <div class="calendar-type ${calendar.type || 'personal'}">${getCalendarTypeText(calendar.type)}</div>
        `;
        
        return item;
    }

    // 캘린더 타입 텍스트 반환
    function getCalendarTypeText(type) {
        switch (type) {
            case 'primary': return '기본';
            case 'shared': return '공유';
            case 'personal': return '개인';
            default: return '개인';
        }
    }

    // 캘린더 선택
    function selectCalendar(calendarId) {
        // 기존 선택 해제
        document.querySelectorAll('.calendar-item').forEach(item => {
            item.classList.remove('selected');
        });
        
        // 새 선택 적용
        const selectedItem = document.querySelector(`[data-calendar-id="${calendarId}"]`);
        if (selectedItem) {
            selectedItem.classList.add('selected');
            selectedCalendarId = calendarId;
            
            // 확인 버튼 활성화
            document.getElementById('confirm-calendar-selection').disabled = false;
        }
    }

    // 캘린더 선택 확인
    async function confirmCalendarSelection() {
        if (!selectedCalendarId || !currentConnectingPlatform) {
            showNotification('캘린더를 선택해주세요.', 'error');
            return;
        }

        // 모달 닫기
        closeCalendarSelectionModal();

        // 실제 플랫폼 연결 진행
        await performPlatformConnection(currentConnectingPlatform, selectedCalendarId);
    }

    // 실제 플랫폼 연결 수행
    async function performPlatformConnection(platformName, calendarId) {
        const button = document.querySelector(`[data-platform="${platformName}"] .platform-connect-btn`);
        const loader = button.querySelector('.connect-loader');
        const buttonText = button.querySelector('.connect-text');
        const card = document.querySelector(`[data-platform="${platformName}"]`);
        const status = card.querySelector('.platform-status');

        // 버튼 상태 변경
        button.disabled = true;
        buttonText.textContent = '연결 중...';
        loader.style.display = 'flex';

        // 카드 애니메이션
        card.style.transform = 'scale(1.02)';
        card.style.boxShadow = 'var(--shadow-lg)';

        try {
            // 실제 연결 API 호출
            const response = await fetch('/api/platform/connect', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    platform: platformName,
                    calendar_id: calendarId
                })
            });

            if (response.ok) {
                const result = await response.json();
                
                if (result.success) {
                    // 연결 성공
                    status.className = 'platform-status connected';
                    status.innerHTML = '<span class="status-dot"></span>연결됨';

                    // 버튼을 연결해제 버튼으로 변경
                    button.className = 'platform-disconnect-btn';
                    button.setAttribute('onclick', `disconnectPlatform('${platformName}')`);
                    buttonText.textContent = '연결 해제';

                    // 통계 및 플랫폼 상태 업데이트
                    updateConnectionStats();
                    updatePlatformStatus();

                    showNotification(`${getKoreanPlatformName(platformName)} 연결 완료!`, 'success');
                } else {
                    showNotification(result.message || '연결에 실패했습니다.', 'error');
                }
            } else {
                // 연결 시뮬레이션 (API가 없는 경우)
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // 80% 성공률로 시뮬레이션
                if (Math.random() > 0.2) {
                    status.className = 'platform-status connected';
                    status.innerHTML = '<span class="status-dot"></span>연결됨';

                    button.className = 'platform-disconnect-btn';
                    button.setAttribute('onclick', `disconnectPlatform('${platformName}')`);
                    buttonText.textContent = '연결 해제';

                    updateConnectionStats();
                    updatePlatformStatus();

                    showNotification(`${getKoreanPlatformName(platformName)} 연결 완료!`, 'success');
                } else {
                    showNotification('연결에 실패했습니다. 다시 시도해주세요.', 'error');
                }
            }
        } catch (error) {
            console.error('연결 중 오류:', error);
            showNotification('연결 중 오류가 발생했습니다.', 'error');
        }

        // 애니메이션 및 상태 복원
        setTimeout(() => {
            button.disabled = false;
            if (button.className === 'platform-connect-btn') {
                buttonText.textContent = '연결하기';
            }
            loader.style.display = 'none';
            card.style.transform = '';
            card.style.boxShadow = '';
        }, 500);

        // 선택 상태 초기화
        selectedCalendarId = null;
        currentConnectingPlatform = null;
    }

    // 캘린더 선택 모달 닫기
    function closeCalendarSelectionModal() {
        const modal = document.getElementById('calendar-selection-modal');
        modal.style.display = 'none';
        
        // 선택 상태 초기화
        selectedCalendarId = null;
        currentConnectingPlatform = null;
        document.getElementById('confirm-calendar-selection').disabled = true;
    }

    // 캘린더 생성 페이지로 리다이렉트
    function redirectToCalendarCreation() {
        closeCalendarSelectionModal();
        window.location.href = '/calendar';
    }

    // 개별 플랫폼 연결 해제 기능
    async function disconnectPlatform(platformName) {
        const button = document.querySelector(`[data-platform="${platformName}"]`);
        const loader = button.querySelector('.disconnect-loader');
        const buttonText = button.querySelector('.disconnect-text');
        const card = document.querySelector(`[data-platform="${platformName}"]`);
        const status = card.querySelector('.platform-status');

        if (!confirm(`${getKoreanPlatformName(platformName)} 연결을 해제하시겠습니까?`)) {
            return;
        }

        // 버튼 상태 변경
        button.disabled = true;
        buttonText.textContent = '해제 중...';
        loader.style.display = 'flex';

        try {
            // 실제 연결 해제 로직 시뮬레이션
            await new Promise(resolve => setTimeout(resolve, 1500));

            // 상태 업데이트
            status.className = 'platform-status disconnected';
            status.innerHTML = '<span class="status-dot"></span>연결되지 않음';

            // 버튼을 연결 버튼으로 변경
            button.className = 'platform-connect-btn';
            button.setAttribute('onclick', `connectPlatform('${platformName}')`);
            buttonText.textContent = '연결하기';

            // 통계 및 플랫폼 상태 업데이트
            updateConnectionStats();
            updatePlatformStatus();

            showNotification(`${getKoreanPlatformName(platformName)} 연결 해제 완료`, 'success');
        } catch (error) {
            console.error('연결 해제 중 오류:', error);
            showNotification('연결 해제 중 오류가 발생했습니다.', 'error');
        }

        // 상태 복원
        setTimeout(() => {
            button.disabled = false;
            if (button.className === 'platform-disconnect-btn') {
                buttonText.textContent = '연결 해제';
            }
            loader.style.display = 'none';
        }, 500);
    }


    // 플랫폼 이름 한국어 변환
    function getKoreanPlatformName(platform) {
        const names = {
            'notion': 'Notion',
            'google': 'Google Calendar',
            'apple': 'Apple Calendar',
            'outlook': 'Outlook',
            'slack': 'Slack'
        };
        return names[platform] || platform;
    }

    // 알림 표시 함수 - NotificationUtils 사용
    function showNotification(message, type = 'info') {
        if (window.NotificationUtils) {
            return window.NotificationUtils.show(message, type);
        }
        // Fallback if NotificationUtils not loaded
        console.log(`[${type}] ${message}`);
    }

    // 실제 플랫폼 연결 상태 업데이트
    async function updatePlatformStatus() {
        try {
            const response = await fetch('/api/dashboard/platforms');
            
            if (response.ok) {
                const data = await response.json();
                
                if (data.success && data.platforms) {
                    const platforms = data.platforms;
                    
                    // 각 플랫폼별 상태 업데이트
                    Object.keys(platforms).forEach(platformName => {
                        const platform = platforms[platformName];
                        const platformCard = document.querySelector(`[data-platform="${platformName}"]`);
                        
                        if (platformCard) {
                            const statusElement = platformCard.querySelector('.platform-status');
                            const connectBtn = platformCard.querySelector('.platform-connect-btn');
                            
                            if (statusElement && platform.configured && platform.enabled) {
                                // 연결된 상태
                                statusElement.className = 'platform-status connected';
                                statusElement.innerHTML = '<span class="status-dot"></span>연결됨';
                                
                                if (connectBtn) {
                                    connectBtn.className = 'platform-disconnect-btn';
                                    connectBtn.setAttribute('onclick', `disconnectPlatform('${platformName}')`);
                                    connectBtn.innerHTML = `
                                        <span class="disconnect-text">연결 해제</span>
                                        <div class="disconnect-loader" style="display: none;">
                                            <div class="loader-dot"></div>
                                        </div>
                                    `;
                                }
                            } else {
                                // 연결되지 않은 상태
                                statusElement.className = 'platform-status disconnected';
                                statusElement.innerHTML = '<span class="status-dot"></span>연결되지 않음';
                                
                                if (connectBtn && connectBtn.className !== 'platform-connect-btn') {
                                    connectBtn.className = 'platform-connect-btn';
                                    connectBtn.setAttribute('onclick', `connectPlatform('${platformName}')`);
                                    connectBtn.innerHTML = `
                                        <span class="connect-text">연결하기</span>
                                        <div class="connect-loader" style="display: none;">
                                            <div class="loader-dot"></div>
                                        </div>
                                    `;
                                }
                            }
                        }
                    });
                    
                    console.log('Platform status updated with real data:', platforms);
                }
            }
        } catch (error) {
            console.error('Error updating platform status:', error);
            // API 에러 시 모든 플랫폼을 연결되지 않은 상태로 설정
            const platformCards = document.querySelectorAll('.platform-card');
            platformCards.forEach(card => {
                const statusElement = card.querySelector('.platform-status');
                if (statusElement) {
                    statusElement.className = 'platform-status disconnected';
                    statusElement.innerHTML = '<span class="status-dot"></span>연결되지 않음';
                }
            });
        }
    }

    // 페이지 로드 시 통계 업데이트
    document.addEventListener('DOMContentLoaded', async function () {
        // 플랫폼 상태를 먼저 업데이트하고, 완료된 후 통계 업데이트
        // 이렇게 하면 순서 문제를 방지할 수 있음
        try {
            await updatePlatformStatus();
            await updateConnectionStats();
        } catch (error) {
            console.error('Error initializing dashboard:', error);
            // 에러 시 모든 값을 0으로 설정
            document.getElementById('connected-count').textContent = '0';
            document.getElementById('sync-count').textContent = '0';
            document.getElementById('success-rate').textContent = '0%';
            document.getElementById('sync-speed').textContent = 'N/A';
        }

        // Update stats every 30 seconds for real-time data
        setInterval(async () => {
            await updatePlatformStatus();
            await updateConnectionStats();
        }, 30000);

        // Update stats when user becomes active (tab focus)
        document.addEventListener('visibilitychange', async function () {
            if (!document.hidden) {
                await updatePlatformStatus();
                await updateConnectionStats();
            }
        });
    });

    async function updateConnectionStats() {
        try {
            // Get real statistics from API
            const response = await fetch('/api/dashboard/stats');

            if (response.ok) {
                const data = await response.json();

                if (data.success && data.stats) {
                    const stats = data.stats;

                    // Update all stat elements with real data
                    document.getElementById('connected-count').textContent = stats.connected_platforms;
                    document.getElementById('sync-count').textContent = stats.synced_events;
                    document.getElementById('success-rate').textContent = stats.success_rate;
                    document.getElementById('sync-speed').textContent = stats.avg_sync_time;

                    console.log('Dashboard stats updated with real data:', stats);
                } else {
                    throw new Error(data.error || 'Failed to load stats');
                }
            } else {
                throw new Error('Failed to fetch dashboard stats');
            }
        } catch (error) {
            console.error('Error updating dashboard stats:', error);

            // API 에러 시 기본값 0으로 설정 (DOM 기반 계산 제거)
            document.getElementById('connected-count').textContent = '0';
            document.getElementById('sync-count').textContent = '0';
            document.getElementById('success-rate').textContent = '0%';
            document.getElementById('sync-speed').textContent = 'N/A';
            console.log('API error - showing zero stats');
        }
    }

    // 개별 플랫폼 원클릭 연동 기능
    async function oneClickConnect(platform) {
        // Apple의 경우 스마트 마법사 실행
        if (platform === 'apple') {
            if (window.appleWizard) {
                window.appleWizard.start(platform);
            } else {
                console.error('Apple Setup Wizard not loaded');
                showNotification('Apple 설정 마법사를 불러오는 중 오류가 발생했습니다.', 'error');
            }
            return;
        }

        const button = document.querySelector(`[data-platform="${platform}"] .one-click-btn-small`);
        const loader = button.querySelector('.btn-loader');
        const buttonText = button.querySelector('.btn-text');
        const buttonIcon = button.querySelector('.btn-icon');

        // 버튼 상태 변경
        button.disabled = true;
        buttonText.style.display = 'none';
        buttonIcon.style.display = 'none';
        loader.style.display = 'flex';

        try {
            // OAuth 지원 플랫폼들
            const oauthPlatforms = ['google', 'notion', 'slack', 'outlook'];

            if (oauthPlatforms.includes(platform)) {
                // OAuth 플로우 실행
                await performOAuthConnection(platform);
            } else {
                // 일반 API 키 방식
                showNotification(`${getKoreanPlatformName(platform)} 연결을 위해 설정 폼을 작성해주세요.`, 'info');
                togglePlatformDetails(platform);
            }

        } catch (error) {
            console.error(`${platform} 연동 중 오류:`, error);
            showNotification(`${getKoreanPlatformName(platform)} 연동 중 오류가 발생했습니다.`, 'error');
        } finally {
            // 버튼 상태 복원
            setTimeout(() => {
                button.disabled = false;
                buttonText.style.display = 'inline';
                buttonIcon.style.display = 'inline';
                loader.style.display = 'none';
            }, 1000);
        }
    }

    // OAuth 연결 수행
    async function performOAuthConnection(platform) {
        try {
            // OAuth 설정 확인
            const configCheck = await fetch(`/oauth/${platform}/check`);
            const configData = await configCheck.json();

            if (!configData.configured) {
                showNotification(
                    `${getKoreanPlatformName(platform)} OAuth가 설정되지 않았습니다. 수동 설정을 사용해주세요.`,
                    'warning'
                );
                // 수동 설정 폼 표시
                togglePlatformDetails(platform);
                return;
            }

            const width = 500;
            const height = 700;
            const left = (screen.width - width) / 2;
            const top = (screen.height - height) / 2;

            const popup = window.open(
                `/oauth/${platform}/authorize`,
                `oauth_${platform}`,
                `width=${width},height=${height},left=${left},top=${top},scrollbars=yes,resizable=yes`
            );

            if (!popup) {
                throw new Error('팝업이 차단되었습니다. OAuth 인증을 위해 팝업을 허용해주세요.');
            }

            // OAuth 완료 대기
            return new Promise((resolve, reject) => {
                const checkInterval = 500;
                let timeoutCount = 0;
                const maxTimeout = 240; // 2분 타임아웃

                // 팝업으로부터 메시지 수신 대기
                const messageHandler = (event) => {
                    if (event.origin !== window.location.origin) {
                        return;
                    }

                    if (event.data && event.data.type) {
                        if (event.data.type === 'oauth_success') {
                            cleanup();
                            updatePlatformStatus(event.data.platform, 'connected');
                            showNotification(`${getKoreanPlatformName(event.data.platform)} 연결 성공!`, 'success');
                            updateConnectionStats();
                            updatePlatformStatus();
                            resolve(event.data);
                        } else if (event.data.type === 'oauth_error') {
                            cleanup();
                            showNotification(`연결 실패: ${event.data.error}`, 'error');
                            reject(new Error(event.data.error || 'OAuth 인증에 실패했습니다'));
                        }
                    }
                };

                // 팝업 닫힘 감지
                const checkClosed = setInterval(() => {
                    if (popup.closed) {
                        cleanup();
                        reject(new Error('OAuth 인증이 취소되었습니다'));
                        return;
                    }

                    timeoutCount++;
                    if (timeoutCount >= maxTimeout) {
                        cleanup();
                        if (!popup.closed) {
                            popup.close();
                        }
                        reject(new Error('OAuth 인증 시간이 초과되었습니다'));
                    }
                }, checkInterval);

                const cleanup = () => {
                    window.removeEventListener('message', messageHandler);
                    clearInterval(checkClosed);
                    if (!popup.closed) {
                        popup.close();
                    }
                };

                window.addEventListener('message', messageHandler);
            });
        } catch (error) {
            console.error('OAuth 연결 실패:', error);
            throw error;
        }
    }

    // 플랫폼 상태 업데이트
    function updatePlatformStatus(platform, status) {
        const card = document.querySelector(`[data-platform="${platform}"]`);
        if (!card) return;

        const statusElement = card.querySelector('.platform-status');
        const connectBtn = card.querySelector('.platform-connect-btn');
        const disconnectBtn = card.querySelector('.platform-disconnect-btn');

        if (status === 'connected') {
            statusElement.className = 'platform-status connected';
            statusElement.innerHTML = '<span class="status-dot"></span>연결됨';

            // 연결 버튼을 연결해제 버튼으로 변경
            if (connectBtn) {
                connectBtn.className = 'platform-disconnect-btn';
                connectBtn.setAttribute('onclick', `disconnectPlatform('${platform}')`);
                connectBtn.innerHTML = `
                <span class="disconnect-text">연결 해제</span>
                <div class="disconnect-loader" style="display: none;">
                    <div class="loader-dot"></div>
                </div>
            `;
            }
        } else {
            statusElement.className = 'platform-status disconnected';
            statusElement.innerHTML = '<span class="status-dot"></span>연결되지 않음';

            // 연결해제 버튼을 연결 버튼으로 변경
            if (disconnectBtn) {
                disconnectBtn.className = 'platform-connect-btn';
                disconnectBtn.setAttribute('onclick', `connectPlatform('${platform}')`);
                disconnectBtn.innerHTML = `
                <span class="connect-text">연결하기</span>
                <div class="connect-loader" style="display: none;">
                    <div class="loader-dot"></div>
                </div>
            `;
            }
        }
    }

    // 플랫폼 세부사항 토글
    function togglePlatformDetails(platform) {
        const details = document.getElementById(`${platform}-details`);
        if (details) {
            const isVisible = details.style.display !== 'none';
            details.style.display = isVisible ? 'none' : 'block';

            const expandBtn = document.querySelector(`[data-platform="${platform}"] .platform-expand-btn`);
            if (expandBtn) {
                expandBtn.style.transform = isVisible ? 'rotate(0deg)' : 'rotate(180deg)';
            }
        }
    }

    // 캘린더 안내 관련 함수들
    function hideCalendarGuide() {
        const guide = document.getElementById('calendar-setup-guide');
        if (guide) {
            guide.style.animation = 'slideOutUp 0.3s ease-in forwards';
            setTimeout(() => {
                guide.classList.add('hidden');
            }, 300);

            // 로컬 스토리지에 숨김 상태 저장
            localStorage.setItem('calendar_guide_hidden', 'true');
        }
    }

    // 연결된 플랫폼이 있으면 자동으로 안내 숨기기
    function checkAndHideGuide() {
        const connectedCount = document.getElementById('connected-count');
        const guide = document.getElementById('calendar-setup-guide');

        if (connectedCount && guide) {
            const count = parseInt(connectedCount.textContent) || 0;
            const isHidden = localStorage.getItem('calendar_guide_hidden') === 'true';

            // 테스트를 위해 임시로 항상 표시
            // if (count > 0 || isHidden) {
            //     guide.classList.add('hidden');
            // }

            // 임시로 항상 보이도록 설정
            guide.classList.remove('hidden');
        }
    }

    // 페이지 로드 시 확인
    document.addEventListener('DOMContentLoaded', function () {
        checkAndHideGuide();

        // 통계 업데이트 후에도 확인
        setTimeout(checkAndHideGuide, 1000);
    });

    // slideOutUp 애니메이션 추가
    const style = document.createElement('style');
    style.textContent = `
    @keyframes slideOutUp {
        from {
            opacity: 1;
            transform: translateY(0);
        }
        to {
            opacity: 0;
            transform: translateY(-20px);
        }
    }
`;
    document.head.appendChild(style);
</script>
{% endblock %}