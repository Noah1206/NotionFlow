{% extends "base_dashboard.html" %}

{% block body_class %}calendar-detail-page{% endblock %}

{% block title %}{{ calendar.name }} - 캘린더 - NotionFlow{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/calendar-detail.css') }}?v={{ range(100000, 999999) | random }}">
{% endblock %}

{% block content %}
<div class="calendar-workspace">
    <!-- Top Navigation Bar -->
    <div class="calendar-topbar">
        <div class="topbar-left">
            <button class="btn-back" onclick="window.location.href='/dashboard/calendar-list'">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
            </button>
            <div class="calendar-header-info">
                <div class="calendar-icon-small" style="background: {{ calendar.color or '#3B82F6' }}"></div>
                <h1 class="calendar-name">{{ calendar.name }}</h1>
            </div>
        </div>
        
        <div class="topbar-center">
            <div class="date-navigator">
                <button class="nav-btn" onclick="changeMonth(-1)">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M15 18l-6-6 6-6"/>
                    </svg>
                </button>
                <span class="current-date" id="current-date">2025년 3월</span>
                <button class="nav-btn" onclick="changeMonth(1)">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M9 18l6-6-6-6"/>
                    </svg>
                </button>
            </div>
            
            <button class="btn-today" onclick="goToToday()">오늘</button>
        </div>
        
        <div class="topbar-right">
            <div class="view-toggle">
                <button class="view-option active" data-view="month">월</button>
                <button class="view-option" data-view="week">주</button>
                <button class="view-option" data-view="agenda">일정</button>
            </div>
            
            <button class="btn-add-event" onclick="openEventModal()">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <line x1="12" y1="5" x2="12" y2="19"/>
                    <line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
                새 이벤트
            </button>
        </div>
    </div>

    <!-- Main Calendar Area -->
    <div class="calendar-workspace-content">
        <!-- Calendar Grid -->
        <div class="calendar-main-area">
            <!-- Month View -->
            <div class="calendar-view-container active" id="month-view">
                <div class="month-header">
                    <div class="weekday-labels">
                        <div class="weekday-label">일</div>
                        <div class="weekday-label">월</div>
                        <div class="weekday-label">화</div>
                        <div class="weekday-label">수</div>
                        <div class="weekday-label">목</div>
                        <div class="weekday-label">금</div>
                        <div class="weekday-label">토</div>
                    </div>
                </div>
                
                <div class="month-grid" id="month-grid">
                    <!-- Calendar cells will be generated here -->
                </div>
            </div>

            <!-- Week View -->
            <div class="calendar-view-container" id="week-view">
                <div class="week-container">
                    <div class="time-column">
                        <div class="time-slot">오전 9시</div>
                        <div class="time-slot">오전 10시</div>
                        <div class="time-slot">오전 11시</div>
                        <div class="time-slot">오후 12시</div>
                        <div class="time-slot">오후 1시</div>
                        <div class="time-slot">오후 2시</div>
                        <div class="time-slot">오후 3시</div>
                        <div class="time-slot">오후 4시</div>
                        <div class="time-slot">오후 5시</div>
                        <div class="time-slot">오후 6시</div>
                    </div>
                    <div class="week-days-grid" id="week-days-grid">
                        <!-- Week view content -->
                    </div>
                </div>
            </div>

            <!-- Agenda View -->
            <div class="calendar-view-container" id="agenda-view">
                <div class="agenda-container">
                    <div class="agenda-header">
                        <h3>다가오는 일정</h3>
                    </div>
                    <div class="agenda-list" id="agenda-list">
                        <div class="agenda-day">
                            <div class="agenda-date">
                                <span class="day-number">21</span>
                                <span class="day-name">목요일</span>
                            </div>
                            <div class="agenda-events">
                                <div class="agenda-event">
                                    <div class="event-time">오후 2:00</div>
                                    <div class="event-info">
                                        <div class="event-title">팀 미팅</div>
                                        <div class="event-desc">주간 진행상황 공유</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="agenda-day">
                            <div class="agenda-date">
                                <span class="day-number">25</span>
                                <span class="day-name">월요일</span>
                            </div>
                            <div class="agenda-events">
                                <div class="agenda-event">
                                    <div class="event-time">오전 10:00</div>
                                    <div class="event-info">
                                        <div class="event-title">프로젝트 발표</div>
                                        <div class="event-desc">Q1 결과 보고</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Sidebar -->
        <div class="calendar-sidebar-area">
            <!-- Mini Calendar -->
            <div class="sidebar-widget">
                <div class="widget-header">
                    <h4>미니 캘린더</h4>
                </div>
                <div class="mini-calendar" id="mini-calendar">
                    <div class="mini-month-nav">
                        <button class="mini-nav-btn" onclick="changeMiniMonth(-1)">‹</button>
                        <span class="mini-month-title">3월 2025</span>
                        <button class="mini-nav-btn" onclick="changeMiniMonth(1)">›</button>
                    </div>
                    <div class="mini-weekdays">
                        <span>일</span><span>월</span><span>화</span><span>수</span><span>목</span><span>금</span><span>토</span>
                    </div>
                    <div class="mini-days" id="mini-days">
                        <!-- Mini calendar days will be generated -->
                    </div>
                </div>
            </div>

            <!-- Today's Schedule -->
            <div class="sidebar-widget">
                <div class="widget-header">
                    <h4>오늘 일정</h4>
                    <span class="widget-badge">2</span>
                </div>
                <div class="today-schedule">
                    <div class="schedule-item">
                        <div class="schedule-time">오후 2:00</div>
                        <div class="schedule-title">팀 미팅</div>
                        <div class="schedule-type">회의</div>
                    </div>
                    <div class="schedule-item">
                        <div class="schedule-time">오후 4:30</div>
                        <div class="schedule-title">클라이언트 통화</div>
                        <div class="schedule-type">업무</div>
                    </div>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="sidebar-widget">
                <div class="widget-header">
                    <h4>통계</h4>
                </div>
                <div class="quick-stats">
                    <div class="stat-row">
                        <span class="stat-label">이번 주</span>
                        <span class="stat-value">8개</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">이번 달</span>
                        <span class="stat-value">{{ calendar.event_count or 0 }}개</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">완료율</span>
                        <span class="stat-value">75%</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Day Detail Modal -->
<div class="modal-overlay" id="day-modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title" id="modal-date">2025년 8월 17일</h2>
            <button class="modal-close" onclick="closeDayModal()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>
        
        <div class="modal-body">
            <div class="day-events" id="day-events">
                <!-- Events for selected day -->
            </div>
            
            <button class="btn-add-event-modal" onclick="addEventToDay()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <line x1="12" y1="5" x2="12" y2="19"/>
                    <line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
                이 날짜에 이벤트 추가
            </button>
        </div>
    </div>
</div>

<!-- Event Creation Modal -->
<div class="modal-overlay" id="event-modal" style="display: none;">
    <div class="modal-content event-modal">
        <div class="modal-header">
            <h2 class="modal-title">새 이벤트</h2>
            <button class="modal-close" onclick="closeEventModal()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>
        
        <div class="modal-body">
            <div class="form-group">
                <label>제목</label>
                <input type="text" id="event-title" placeholder="이벤트 제목 입력">
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>시작일</label>
                    <input type="datetime-local" id="event-start">
                </div>
                <div class="form-group">
                    <label>종료일</label>
                    <input type="datetime-local" id="event-end">
                </div>
            </div>
            
            <div class="form-group">
                <label>설명</label>
                <textarea id="event-description" rows="4" placeholder="이벤트 설명 (선택사항)"></textarea>
            </div>
            
            <div class="form-group">
                <label>색상</label>
                <div class="color-picker">
                    <button class="color-option active" data-color="#3B82F6" style="background: #3B82F6"></button>
                    <button class="color-option" data-color="#10B981" style="background: #10B981"></button>
                    <button class="color-option" data-color="#F59E0B" style="background: #F59E0B"></button>
                    <button class="color-option" data-color="#EF4444" style="background: #EF4444"></button>
                    <button class="color-option" data-color="#8B5CF6" style="background: #8B5CF6"></button>
                    <button class="color-option" data-color="#EC4899" style="background: #EC4899"></button>
                </div>
            </div>
            
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="event-allday">
                    <span>종일 이벤트</span>
                </label>
            </div>
            
            <div class="form-actions">
                <button class="btn-cancel" onclick="closeEventModal()">취소</button>
                <button class="btn-save" onclick="saveEvent()">저장</button>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/calendar-detail.js') }}?v={{ range(100000, 999999) | random }}"></script>
{% endblock %}