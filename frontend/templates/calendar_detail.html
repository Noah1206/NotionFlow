{% extends "base_dashboard.html" %}

{% block body_class %}calendar-detail-page{% endblock %}

{% block title %}{{ calendar.name }} - 캘린더 - NotionFlow{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/calendar-detail.css') }}?v={{ range(100000, 999999) | random }}">
{% endblock %}

{% block content %}
<div class="calendar-container">
    <!-- Calendar Header -->
    <div class="calendar-header">
        <div class="header-left">
            <button class="btn-back" onclick="window.location.href='/dashboard/calendar-list'">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
            </button>
            <div class="calendar-title-section">
                <div class="calendar-icon" style="background: {{ calendar.color or '#3B82F6' }}">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
                        <rect x="3" y="4" width="18" height="18" rx="2"/>
                        <line x1="16" y1="2" x2="16" y2="6"/>
                        <line x1="8" y1="2" x2="8" y2="6"/>
                        <line x1="3" y1="10" x2="21" y2="10"/>
                    </svg>
                </div>
                <h1 class="calendar-title">{{ calendar.name }}</h1>
                <span class="calendar-badge">{{ calendar.platform or 'Custom' }}</span>
            </div>
        </div>

        <div class="header-center">
            <button class="btn-today" onclick="goToToday()">오늘</button>
            <div class="month-navigation">
                <button class="btn-nav" onclick="changeMonth(-1)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M15 18l-6-6 6-6"/>
                    </svg>
                </button>
                <h2 class="current-month" id="current-month">2025년 8월</h2>
                <button class="btn-nav" onclick="changeMonth(1)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M9 18l6-6-6-6"/>
                    </svg>
                </button>
            </div>
        </div>

        <div class="header-right">
            <div class="view-switcher">
                <button class="view-btn active" data-view="month" onclick="switchView('month')">월</button>
                <button class="view-btn" data-view="week" onclick="switchView('week')">주</button>
                <button class="view-btn" data-view="day" onclick="switchView('day')">일</button>
                <button class="view-btn" data-view="list" onclick="switchView('list')">목록</button>
            </div>
            
            <div class="header-actions">
                <button class="btn-add-event" onclick="openEventModal()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <line x1="12" y1="5" x2="12" y2="19"/>
                        <line x1="5" y1="12" x2="19" y2="12"/>
                    </svg>
                    이벤트 추가
                </button>
                
                <button class="btn-sync" onclick="syncCalendar()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                    </svg>
                </button>
                
                <button class="btn-settings" onclick="openSettings()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M12 1v6m0 6v6m3.22-13.152l1.516-.88 3.476 2.007-1.517.88m-5.95 12.29l1.517.88 3.476-2.007-1.516-.88M1 12h6m6 0h6"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Calendar Grid -->
    <div class="calendar-main">
        <!-- Month View -->
        <div class="calendar-view active" id="month-view">
            <div class="weekdays">
                <div class="weekday">일</div>
                <div class="weekday">월</div>
                <div class="weekday">화</div>
                <div class="weekday">수</div>
                <div class="weekday">목</div>
                <div class="weekday">금</div>
                <div class="weekday">토</div>
            </div>
            <div class="calendar-grid" id="calendar-grid">
                <!-- Calendar days will be generated here -->
            </div>
        </div>

        <!-- Week View -->
        <div class="calendar-view" id="week-view">
            <div class="week-timeline">
                <div class="time-labels">
                    <div class="time-label">오전 12시</div>
                    <div class="time-label">오전 6시</div>
                    <div class="time-label">오후 12시</div>
                    <div class="time-label">오후 6시</div>
                </div>
                <div class="week-days-container">
                    <!-- Week view content -->
                </div>
            </div>
        </div>

        <!-- Day View -->
        <div class="calendar-view" id="day-view">
            <div class="day-timeline">
                <!-- Day view content -->
            </div>
        </div>

        <!-- List View -->
        <div class="calendar-view" id="list-view">
            <div class="events-list">
                <!-- List view content -->
            </div>
        </div>
    </div>

    <!-- Sidebar -->
    <div class="calendar-sidebar">
        <div class="sidebar-section">
            <h3 class="sidebar-title">오늘의 일정</h3>
            <div class="today-events" id="today-events">
                <div class="no-events">오늘 일정이 없습니다</div>
            </div>
        </div>

        <div class="sidebar-section">
            <h3 class="sidebar-title">다가오는 일정</h3>
            <div class="upcoming-events" id="upcoming-events">
                <div class="event-item">
                    <div class="event-time">8월 20일 오후 2시</div>
                    <div class="event-title">팀 미팅</div>
                </div>
                <div class="event-item">
                    <div class="event-time">8월 22일 오전 10시</div>
                    <div class="event-title">프로젝트 발표</div>
                </div>
            </div>
        </div>

        <div class="sidebar-section">
            <h3 class="sidebar-title">캘린더 통계</h3>
            <div class="calendar-stats">
                <div class="stat-item">
                    <span class="stat-label">총 이벤트</span>
                    <span class="stat-value">{{ calendar.event_count or 0 }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">이번 달</span>
                    <span class="stat-value" id="month-events">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">이번 주</span>
                    <span class="stat-value" id="week-events">0</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Day Detail Modal -->
<div class="modal-overlay" id="day-modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title" id="modal-date">2025년 8월 17일</h2>
            <button class="modal-close" onclick="closeDayModal()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>
        
        <div class="modal-body">
            <div class="day-events" id="day-events">
                <!-- Events for selected day -->
            </div>
            
            <button class="btn-add-event-modal" onclick="addEventToDay()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <line x1="12" y1="5" x2="12" y2="19"/>
                    <line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
                이 날짜에 이벤트 추가
            </button>
        </div>
    </div>
</div>

<!-- Event Creation Modal -->
<div class="modal-overlay" id="event-modal" style="display: none;">
    <div class="modal-content event-modal">
        <div class="modal-header">
            <h2 class="modal-title">새 이벤트</h2>
            <button class="modal-close" onclick="closeEventModal()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>
        
        <div class="modal-body">
            <div class="form-group">
                <label>제목</label>
                <input type="text" id="event-title" placeholder="이벤트 제목 입력">
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>시작일</label>
                    <input type="datetime-local" id="event-start">
                </div>
                <div class="form-group">
                    <label>종료일</label>
                    <input type="datetime-local" id="event-end">
                </div>
            </div>
            
            <div class="form-group">
                <label>설명</label>
                <textarea id="event-description" rows="4" placeholder="이벤트 설명 (선택사항)"></textarea>
            </div>
            
            <div class="form-group">
                <label>색상</label>
                <div class="color-picker">
                    <button class="color-option active" data-color="#3B82F6" style="background: #3B82F6"></button>
                    <button class="color-option" data-color="#10B981" style="background: #10B981"></button>
                    <button class="color-option" data-color="#F59E0B" style="background: #F59E0B"></button>
                    <button class="color-option" data-color="#EF4444" style="background: #EF4444"></button>
                    <button class="color-option" data-color="#8B5CF6" style="background: #8B5CF6"></button>
                    <button class="color-option" data-color="#EC4899" style="background: #EC4899"></button>
                </div>
            </div>
            
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="event-allday">
                    <span>종일 이벤트</span>
                </label>
            </div>
            
            <div class="form-actions">
                <button class="btn-cancel" onclick="closeEventModal()">취소</button>
                <button class="btn-save" onclick="saveEvent()">저장</button>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/calendar-detail.js') }}?v={{ range(100000, 999999) | random }}"></script>
{% endblock %}