{% extends "base_dashboard.html" %}

{% block title %}Calendar Management - NotionFlow{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/calendar-list.css') }}?v={{ range(100000, 999999) | random }}">
{% endblock %}

{% block content %}
<div class="calendar-management-container">
    <div class="calendar-header">
        <div class="header-content">
            <h1 class="page-title">ğŸ“± ìº˜ë¦°ë” ê´€ë¦¬</h1>
            <p class="page-subtitle">ì—¬ëŸ¬ í”Œë«í¼ì˜ ìº˜ë¦°ë”ë¥¼ í•˜ë‚˜ì˜ í†µí•© ì¸í„°í˜ì´ìŠ¤ì—ì„œ ê´€ë¦¬í•˜ì„¸ìš”</p>
        </div>
        <div class="header-actions">
            <button class="btn btn-primary" onclick="openNewCalendarModal()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                ìƒˆ ìº˜ë¦°ë”
            </button>
        </div>
    </div>

    <!-- ê²€ìƒ‰ì°½ -->
    <div class="search-section">
        <div class="search-container">
            <input type="text" 
                   class="search-input" 
                   placeholder="ğŸ” ìº˜ë¦°ë” ê²€ìƒ‰..." 
                   id="calendar-search"
                   onkeyup="filterCalendars(this.value)">
        </div>
    </div>

    <!-- ê°œì¸ ìº˜ë¦°ë” ì„¹ì…˜ -->
    <div class="calendar-section">
        <div class="section-header" onclick="toggleSection('personal')">
            <h2 class="section-title">
                <span class="section-icon">ğŸ‘¤</span>
                ê°œì¸ ìº˜ë¦°ë”
            </h2>
            <span class="toggle-icon" id="personal-toggle">â–¼</span>
        </div>
        <div class="section-content" id="personal-content">
            <div class="calendar-grid">
                <div class="calendar-item" data-name="ë‚´ ì¼ì •">
                    <div class="calendar-card" onclick="openCalendarView('ë‚´ ì¼ì •')">
                        <div class="calendar-info">
                            <h3 class="calendar-name">ğŸ“… ë‚´ ì¼ì •</h3>
                            <p class="calendar-desc">ê°œì¸ ì¼ì •ê³¼ ë¯¸íŒ…</p>
                        </div>
                        <div class="calendar-status active">í™œì„±</div>
                    </div>
                </div>
                
                <div class="calendar-item" data-name="ê°œì¸ í”„ë¡œì íŠ¸">
                    <div class="calendar-card" onclick="openCalendarView('ê°œì¸ í”„ë¡œì íŠ¸')">
                        <div class="calendar-info">
                            <h3 class="calendar-name">ğŸ’» ê°œì¸ í”„ë¡œì íŠ¸</h3>
                            <p class="calendar-desc">ì‚¬ì´ë“œ í”„ë¡œì íŠ¸ì™€ ê°œë°œ</p>
                        </div>
                        <div class="calendar-status active">í™œì„±</div>
                    </div>
                </div>
                
                <div class="calendar-item" data-name="ìš´ë™ ìŠ¤ì¼€ì¤„">
                    <div class="calendar-card" onclick="openCalendarView('ìš´ë™ ìŠ¤ì¼€ì¤„')">
                        <div class="calendar-info">
                            <h3 class="calendar-name">ğŸƒâ€â™‚ï¸ ìš´ë™ ìŠ¤ì¼€ì¤„</h3>
                            <p class="calendar-desc">í—¬ìŠ¤ì™€ ìš´ë™ ì¼ì •</p>
                        </div>
                        <div class="calendar-status inactive">ë¹„í™œì„±</div>
                    </div>
                </div>
                
                <div class="calendar-item" data-name="ë…ì„œ ê³„íš">
                    <div class="calendar-card" onclick="openCalendarView('ë…ì„œ ê³„íš')">
                        <div class="calendar-info">
                            <h3 class="calendar-name">ğŸ“š ë…ì„œ ê³„íš</h3>
                            <p class="calendar-desc">ì½ì„ ì±…ê³¼ ë…ì„œ ëª©í‘œ</p>
                        </div>
                        <div class="calendar-status active">í™œì„±</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ê³µìœ  ìº˜ë¦°ë” ì„¹ì…˜ -->
    <div class="calendar-section">
        <div class="section-header" onclick="toggleSection('shared')">
            <h2 class="section-title">
                <span class="section-icon">ğŸ‘¥</span>
                ê³µìœ  ìº˜ë¦°ë”
            </h2>
            <span class="toggle-icon" id="shared-toggle">â–¼</span>
        </div>
        <div class="section-content" id="shared-content">
            <div class="calendar-grid">
                <div class="calendar-item" data-name="íŒ€ ë¯¸íŒ…">
                    <div class="calendar-card" onclick="openCalendarView('íŒ€ ë¯¸íŒ…')">
                        <div class="calendar-info">
                            <h3 class="calendar-name">ğŸ¤ íŒ€ ë¯¸íŒ…</h3>
                            <p class="calendar-desc">íŒ€ íšŒì˜ì™€ ìŠ¤íƒ ë“œì—…</p>
                        </div>
                        <div class="calendar-status active">í™œì„±</div>
                    </div>
                </div>
                
                <div class="calendar-item" data-name="íšŒì‚¬ ì´ë²¤íŠ¸">
                    <div class="calendar-card" onclick="openCalendarView('íšŒì‚¬ ì´ë²¤íŠ¸')">
                        <div class="calendar-info">
                            <h3 class="calendar-name">ğŸ¢ íšŒì‚¬ ì´ë²¤íŠ¸</h3>
                            <p class="calendar-desc">íšŒì‚¬ í–‰ì‚¬ì™€ êµìœ¡</p>
                        </div>
                        <div class="calendar-status active">í™œì„±</div>
                    </div>
                </div>
                
                <div class="calendar-item" data-name="ê°€ì¡± ì¼ì •">
                    <div class="calendar-card" onclick="openCalendarView('ê°€ì¡± ì¼ì •')">
                        <div class="calendar-info">
                            <h3 class="calendar-name">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ê°€ì¡± ì¼ì •</h3>
                            <p class="calendar-desc">ê°€ì¡± ëª¨ì„ê³¼ í–‰ì‚¬</p>
                        </div>
                        <div class="calendar-status inactive">ë¹„í™œì„±</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ìƒˆ ìº˜ë¦°ë” ì¶”ê°€ ì„¹ì…˜ -->
    <div class="add-calendar-section">
        <div class="add-calendar-card" onclick="openNewCalendarModal()">
            <div class="add-icon">+</div>
            <div class="add-content">
                <h3>ìƒˆ ìº˜ë¦°ë” ì¶”ê°€</h3>
                <p>í”Œë«í¼ ì—°ê²° ë˜ëŠ” ìƒˆë¡œìš´ ìº˜ë¦°ë” ìƒì„±</p>
            </div>
        </div>
    </div>
</div>

<!-- ìƒˆ ìº˜ë¦°ë” ëª¨ë‹¬ -->
<div class="modal-overlay" id="new-calendar-modal" style="display: none;">
    <div class="modal-container">
        <div class="modal-header">
            <h3>ìƒˆ ìº˜ë¦°ë” ì¶”ê°€</h3>
            <button class="modal-close" onclick="closeNewCalendarModal()">Ã—</button>
        </div>
        <div class="modal-body">
            <div class="calendar-type-options">
                <div class="type-option" onclick="selectCalendarType('personal')">
                    <div class="option-icon">ğŸ‘¤</div>
                    <div class="option-content">
                        <h4>ê°œì¸ ìº˜ë¦°ë”</h4>
                        <p>ê°œì¸ ì¼ì •ê³¼ í”„ë¡œì íŠ¸ ê´€ë¦¬</p>
                    </div>
                </div>
                <div class="type-option" onclick="selectCalendarType('shared')">
                    <div class="option-icon">ğŸ‘¥</div>
                    <div class="option-content">
                        <h4>ê³µìœ  ìº˜ë¦°ë”</h4>
                        <p>íŒ€ê³¼ ê³µìœ í•˜ëŠ” ìº˜ë¦°ë”</p>
                    </div>
                </div>
                <div class="type-option" onclick="selectCalendarType('external')">
                    <div class="option-icon">ğŸ”—</div>
                    <div class="option-content">
                        <h4>ì™¸ë¶€ ì—°ê²°</h4>
                        <p>Google, Apple, Outlook ë“±</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// ì„¹ì…˜ í† ê¸€ í•¨ìˆ˜
function toggleSection(sectionName) {
    const content = document.getElementById(sectionName + '-content');
    const toggle = document.getElementById(sectionName + '-toggle');
    
    if (content.style.display === 'none' || content.style.display === '') {
        content.style.display = 'block';
        toggle.textContent = 'â–²';
    } else {
        content.style.display = 'none';
        toggle.textContent = 'â–¼';
    }
}

// ìº˜ë¦°ë” ê²€ìƒ‰ í•¨ìˆ˜
function filterCalendars(searchTerm) {
    const items = document.querySelectorAll('.calendar-item');
    const term = searchTerm.toLowerCase();
    
    items.forEach(item => {
        const name = item.getAttribute('data-name').toLowerCase();
        if (name.includes(term) || term === '') {
            item.style.display = 'block';
        } else {
            item.style.display = 'none';
        }
    });
}

// ê°œë³„ ìº˜ë¦°ë” ë·° ì—´ê¸° í•¨ìˆ˜
function openCalendarView(calendarName) {
    console.log('ğŸ¯ ìº˜ë¦°ë” ë·° ì—´ê¸°:', calendarName);
    
    // ìº˜ë¦°ë” ì´ë¦„ì„ URL-safeí•˜ê²Œ ë³€í™˜
    const urlSafeName = calendarName
        .replace(/\s+/g, '-')
        .replace(/[^ê°€-í£a-zA-Z0-9-]/g, '')
        .toLowerCase();
    
    const targetUrl = `/dashboard/calendar/${urlSafeName}?view=calendar`;
    console.log('ğŸ“ ì´ë™í•  URL:', targetUrl);
    
    // í˜ì´ì§€ ì´ë™
    window.location.href = targetUrl;
}

// ìƒˆ ìº˜ë¦°ë” ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜
function openNewCalendarModal() {
    document.getElementById('new-calendar-modal').style.display = 'flex';
}

function closeNewCalendarModal() {
    document.getElementById('new-calendar-modal').style.display = 'none';
}

function selectCalendarType(type) {
    console.log('Selected calendar type:', type);
    // ìº˜ë¦°ë” íƒ€ì…ì— ë”°ë¥¸ ì²˜ë¦¬ ë¡œì§
    closeNewCalendarModal();
}

// ì´ˆê¸°í™”
document.addEventListener('DOMContentLoaded', function() {
    console.log('âœ… ìº˜ë¦°ë” ê´€ë¦¬ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
});
</script>
{% endblock %}