{% extends "base_dashboard.html" %}

{% block title %}Calendar Management - NotionFlow{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/calendar-list.css') }}?v={{ range(100000, 999999) | random }}">
{% endblock %}

{% block content %}
<div class="calendar-management-container">
    <div class="calendar-header">
        <div class="header-content">
            <h1 class="page-title">📱 캘린더 관리</h1>
            <p class="page-subtitle">여러 플랫폼의 캘린더를 하나의 통합 인터페이스에서 관리하세요</p>
        </div>
        <div class="header-actions">
            <button class="btn btn-primary" onclick="openNewCalendarModal()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                새 캘린더
            </button>
        </div>
    </div>

    <!-- 검색창 -->
    <div class="search-section">
        <div class="search-container">
            <input type="text" 
                   class="search-input" 
                   placeholder="🔍 캘린더 검색..." 
                   id="calendar-search"
                   onkeyup="filterCalendars(this.value)">
        </div>
    </div>

    <!-- 개인 캘린더 섹션 -->
    <div class="calendar-section">
        <div class="section-header" onclick="toggleSection('personal')">
            <h2 class="section-title">
                <span class="section-icon">👤</span>
                개인 캘린더
            </h2>
            <span class="toggle-icon" id="personal-toggle">▼</span>
        </div>
        <div class="section-content" id="personal-content">
            <div class="calendar-grid">
                <div class="calendar-item" data-name="내 일정">
                    <div class="calendar-card" onclick="openCalendarView('내 일정')">
                        <div class="calendar-info">
                            <h3 class="calendar-name">📅 내 일정</h3>
                            <p class="calendar-desc">개인 일정과 미팅</p>
                        </div>
                        <div class="calendar-status active">활성</div>
                    </div>
                </div>
                
                <div class="calendar-item" data-name="개인 프로젝트">
                    <div class="calendar-card" onclick="openCalendarView('개인 프로젝트')">
                        <div class="calendar-info">
                            <h3 class="calendar-name">💻 개인 프로젝트</h3>
                            <p class="calendar-desc">사이드 프로젝트와 개발</p>
                        </div>
                        <div class="calendar-status active">활성</div>
                    </div>
                </div>
                
                <div class="calendar-item" data-name="운동 스케줄">
                    <div class="calendar-card" onclick="openCalendarView('운동 스케줄')">
                        <div class="calendar-info">
                            <h3 class="calendar-name">🏃‍♂️ 운동 스케줄</h3>
                            <p class="calendar-desc">헬스와 운동 일정</p>
                        </div>
                        <div class="calendar-status inactive">비활성</div>
                    </div>
                </div>
                
                <div class="calendar-item" data-name="독서 계획">
                    <div class="calendar-card" onclick="openCalendarView('독서 계획')">
                        <div class="calendar-info">
                            <h3 class="calendar-name">📚 독서 계획</h3>
                            <p class="calendar-desc">읽을 책과 독서 목표</p>
                        </div>
                        <div class="calendar-status active">활성</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 공유 캘린더 섹션 -->
    <div class="calendar-section">
        <div class="section-header" onclick="toggleSection('shared')">
            <h2 class="section-title">
                <span class="section-icon">👥</span>
                공유 캘린더
            </h2>
            <span class="toggle-icon" id="shared-toggle">▼</span>
        </div>
        <div class="section-content" id="shared-content">
            <div class="calendar-grid">
                <div class="calendar-item" data-name="팀 미팅">
                    <div class="calendar-card" onclick="openCalendarView('팀 미팅')">
                        <div class="calendar-info">
                            <h3 class="calendar-name">🤝 팀 미팅</h3>
                            <p class="calendar-desc">팀 회의와 스탠드업</p>
                        </div>
                        <div class="calendar-status active">활성</div>
                    </div>
                </div>
                
                <div class="calendar-item" data-name="회사 이벤트">
                    <div class="calendar-card" onclick="openCalendarView('회사 이벤트')">
                        <div class="calendar-info">
                            <h3 class="calendar-name">🏢 회사 이벤트</h3>
                            <p class="calendar-desc">회사 행사와 교육</p>
                        </div>
                        <div class="calendar-status active">활성</div>
                    </div>
                </div>
                
                <div class="calendar-item" data-name="가족 일정">
                    <div class="calendar-card" onclick="openCalendarView('가족 일정')">
                        <div class="calendar-info">
                            <h3 class="calendar-name">👨‍👩‍👧‍👦 가족 일정</h3>
                            <p class="calendar-desc">가족 모임과 행사</p>
                        </div>
                        <div class="calendar-status inactive">비활성</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 새 캘린더 추가 섹션 -->
    <div class="add-calendar-section">
        <div class="add-calendar-card" onclick="openNewCalendarModal()">
            <div class="add-icon">+</div>
            <div class="add-content">
                <h3>새 캘린더 추가</h3>
                <p>플랫폼 연결 또는 새로운 캘린더 생성</p>
            </div>
        </div>
    </div>
</div>

<!-- 새 캘린더 모달 -->
<div class="modal-overlay" id="new-calendar-modal" style="display: none;">
    <div class="modal-container">
        <div class="modal-header">
            <h3>새 캘린더 추가</h3>
            <button class="modal-close" onclick="closeNewCalendarModal()">×</button>
        </div>
        <div class="modal-body">
            <div class="calendar-type-options">
                <div class="type-option" onclick="selectCalendarType('personal')">
                    <div class="option-icon">👤</div>
                    <div class="option-content">
                        <h4>개인 캘린더</h4>
                        <p>개인 일정과 프로젝트 관리</p>
                    </div>
                </div>
                <div class="type-option" onclick="selectCalendarType('shared')">
                    <div class="option-icon">👥</div>
                    <div class="option-content">
                        <h4>공유 캘린더</h4>
                        <p>팀과 공유하는 캘린더</p>
                    </div>
                </div>
                <div class="type-option" onclick="selectCalendarType('external')">
                    <div class="option-icon">🔗</div>
                    <div class="option-content">
                        <h4>외부 연결</h4>
                        <p>Google, Apple, Outlook 등</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// 섹션 토글 함수
function toggleSection(sectionName) {
    const content = document.getElementById(sectionName + '-content');
    const toggle = document.getElementById(sectionName + '-toggle');
    
    if (content.style.display === 'none' || content.style.display === '') {
        content.style.display = 'block';
        toggle.textContent = '▲';
    } else {
        content.style.display = 'none';
        toggle.textContent = '▼';
    }
}

// 캘린더 검색 함수
function filterCalendars(searchTerm) {
    const items = document.querySelectorAll('.calendar-item');
    const term = searchTerm.toLowerCase();
    
    items.forEach(item => {
        const name = item.getAttribute('data-name').toLowerCase();
        if (name.includes(term) || term === '') {
            item.style.display = 'block';
        } else {
            item.style.display = 'none';
        }
    });
}

// 개별 캘린더 뷰 열기 함수
function openCalendarView(calendarName) {
    console.log('🎯 캘린더 뷰 열기:', calendarName);
    
    // 캘린더 이름을 URL-safe하게 변환
    const urlSafeName = calendarName
        .replace(/\s+/g, '-')
        .replace(/[^가-힣a-zA-Z0-9-]/g, '')
        .toLowerCase();
    
    const targetUrl = `/dashboard/calendar/${urlSafeName}?view=calendar`;
    console.log('📍 이동할 URL:', targetUrl);
    
    // 페이지 이동
    window.location.href = targetUrl;
}

// 새 캘린더 모달 관련 함수
function openNewCalendarModal() {
    document.getElementById('new-calendar-modal').style.display = 'flex';
}

function closeNewCalendarModal() {
    document.getElementById('new-calendar-modal').style.display = 'none';
}

function selectCalendarType(type) {
    console.log('Selected calendar type:', type);
    // 캘린더 타입에 따른 처리 로직
    closeNewCalendarModal();
}

// 초기화
document.addEventListener('DOMContentLoaded', function() {
    console.log('✅ 캘린더 관리 페이지 로드 완료');
});
</script>
{% endblock %}